{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/dashboard/components/useCashflowData.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"../../../../lib/supabaseClient\";\r\n\r\nexport function useCashflowData(year) {\r\n  const [transactions, setTransactions] = useState([]);\r\n  const [chartData, setChartData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (year) fetchCashflow();\r\n  }, [year]);\r\n\r\n  const fetchCashflow = async () => {\r\n    setLoading(true);\r\n\r\n    const startDate = `${year}-01-01`;\r\n    const endDate = `${year}-12-31`;\r\n\r\n    // 1️⃣ Fetch transactions FOR SELECTED YEAR ONLY\r\n    const { data, error } = await supabase\r\n      .from(\"transactions\")\r\n      .select(\"*\")\r\n      .gte(\"date\", startDate)\r\n      .lte(\"date\", endDate)\r\n      .order(\"date\", { ascending: true });\r\n\r\n    if (error) {\r\n      console.error(\"❌ Supabase fetch error:\", error.message);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // 2️⃣ Clean numeric values\r\n    const mapped = (data || [])\r\n      .filter((row) => row.date)\r\n      .map((row) => ({\r\n        ...row,\r\n        deposit: Number(String(row.deposit || \"0\").replace(/[₱, ]/g, \"\")),\r\n        withdrawal: Number(String(row.withdrawal || \"0\").replace(/[₱, ]/g, \"\")),\r\n        balance: Number(String(row.balance || \"0\").replace(/[₱, ]/g, \"\")),\r\n\r\n        // OPTIONAL: normalize categories (safe)\r\n        incomeCategory: row.income_category || row.category || null,\r\n        expenseCategory: row.expense_category || row.category || null,\r\n      }));\r\n\r\n    setTransactions(mapped);\r\n\r\n    // 3️⃣ Aggregate per month\r\n    const grouped = {};\r\n\r\n    mapped.forEach((t) => {\r\n      const d = new Date(t.date);\r\n      const monthKey = d.toLocaleString(\"default\", {\r\n        month: \"short\",\r\n        year: \"numeric\",\r\n      });\r\n\r\n      if (!grouped[monthKey]) {\r\n        grouped[monthKey] = {\r\n          month: monthKey,\r\n          income: 0,\r\n          expense: 0,\r\n          balance: 0,\r\n        };\r\n      }\r\n\r\n      grouped[monthKey].income += t.deposit || 0;\r\n      grouped[monthKey].expense += t.withdrawal || 0;\r\n\r\n      // last balance of the month\r\n      grouped[monthKey].balance = t.balance || grouped[monthKey].balance;\r\n    });\r\n\r\n    const monthlyArray = Object.values(grouped)\r\n      .sort((a, b) => new Date(a.month) - new Date(b.month))\r\n      .map((g) => ({\r\n        ...g,\r\n        net: g.income - g.expense,\r\n      }));\r\n\r\n    setChartData(monthlyArray);\r\n    setLoading(false);\r\n  };\r\n\r\n  return {\r\n    transactions,\r\n    chartData,\r\n    loading,\r\n    refetch: fetchCashflow,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAKO,SAAS,gBAAgB,IAAI;IAClC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,2NAAQ,EAAC,EAAE;IACnD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,2NAAQ,EAAC,EAAE;IAC7C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,2NAAQ,EAAC;IAEvC,IAAA,4NAAS,EAAC;QACR,IAAI,MAAM;IACZ,GAAG;QAAC;KAAK;IAET,MAAM,gBAAgB;QACpB,WAAW;QAEX,MAAM,YAAY,GAAG,KAAK,MAAM,CAAC;QACjC,MAAM,UAAU,GAAG,KAAK,MAAM,CAAC;QAE/B,gDAAgD;QAChD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,GAAG,CAAC,QAAQ,WACZ,GAAG,CAAC,QAAQ,SACZ,KAAK,CAAC,QAAQ;YAAE,WAAW;QAAK;QAEnC,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,2BAA2B,MAAM,OAAO;YACtD,WAAW;YACX;QACF;QAEA,2BAA2B;QAC3B,MAAM,SAAS,CAAC,QAAQ,EAAE,EACvB,MAAM,CAAC,CAAC,MAAQ,IAAI,IAAI,EACxB,GAAG,CAAC,CAAC,MAAQ,CAAC;gBACb,GAAG,GAAG;gBACN,SAAS,OAAO,OAAO,IAAI,OAAO,IAAI,KAAK,OAAO,CAAC,UAAU;gBAC7D,YAAY,OAAO,OAAO,IAAI,UAAU,IAAI,KAAK,OAAO,CAAC,UAAU;gBACnE,SAAS,OAAO,OAAO,IAAI,OAAO,IAAI,KAAK,OAAO,CAAC,UAAU;gBAE7D,wCAAwC;gBACxC,gBAAgB,IAAI,eAAe,IAAI,IAAI,QAAQ,IAAI;gBACvD,iBAAiB,IAAI,gBAAgB,IAAI,IAAI,QAAQ,IAAI;YAC3D,CAAC;QAEH,gBAAgB;QAEhB,0BAA0B;QAC1B,MAAM,UAAU,CAAC;QAEjB,OAAO,OAAO,CAAC,CAAC;YACd,MAAM,IAAI,IAAI,KAAK,EAAE,IAAI;YACzB,MAAM,WAAW,EAAE,cAAc,CAAC,WAAW;gBAC3C,OAAO;gBACP,MAAM;YACR;YAEA,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;gBACtB,OAAO,CAAC,SAAS,GAAG;oBAClB,OAAO;oBACP,QAAQ;oBACR,SAAS;oBACT,SAAS;gBACX;YACF;YAEA,OAAO,CAAC,SAAS,CAAC,MAAM,IAAI,EAAE,OAAO,IAAI;YACzC,OAAO,CAAC,SAAS,CAAC,OAAO,IAAI,EAAE,UAAU,IAAI;YAE7C,4BAA4B;YAC5B,OAAO,CAAC,SAAS,CAAC,OAAO,GAAG,EAAE,OAAO,IAAI,OAAO,CAAC,SAAS,CAAC,OAAO;QACpE;QAEA,MAAM,eAAe,OAAO,MAAM,CAAC,SAChC,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,KAAK,IAAI,IAAI,KAAK,EAAE,KAAK,GACnD,GAAG,CAAC,CAAC,IAAM,CAAC;gBACX,GAAG,CAAC;gBACJ,KAAK,EAAE,MAAM,GAAG,EAAE,OAAO;YAC3B,CAAC;QAEH,aAAa;QACb,WAAW;IACb;IAEA,OAAO;QACL;QACA;QACA;QACA,SAAS;IACX;AACF","debugId":null}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transaction/print/page.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useRef } from \"react\"\r\nimport { useSearchParams } from \"next/navigation\"\r\nimport { useCashflowData } from \"../../dashboard/components/useCashflowData\"\r\n\r\n// =====================\r\n// MONTH LABELS\r\n// =====================\r\nconst MONTHS = [\r\n  \"JANUARY\", \"FEBRUARY\", \"MARCH\", \"APRIL\",\r\n  \"MAY\", \"JUNE\", \"JULY\", \"AUGUST\",\r\n  \"SEPTEMBER\", \"OCTOBER\", \"NOVEMBER\", \"DECEMBER\"\r\n]\r\n\r\n// =====================\r\n// INCOME CATEGORIZER (LOCAL)\r\n// =====================\r\nfunction categorizeIncome(desc = \"\") {\r\n  const t = desc.toLowerCase()\r\n\r\n  if (t.includes(\"real property\") || t.includes(\"rpt\"))\r\n    return \"Real Property Tax\"\r\n  if (t.includes(\"interest\"))\r\n    return \"Interest Income\"\r\n  if (t.includes(\"nta\"))\r\n    return \"National Taxation Allocation (NTA)\"\r\n  if (t.includes(\"rental\"))\r\n    return \"Rental Fees\"\r\n  if (t.includes(\"clearance\") || t.includes(\"certification\"))\r\n    return \"Clearance & Certification Fees\"\r\n\r\n  return \"Other Income\"\r\n}\r\n\r\nexport default function TransactionPrintPage() {\r\n  const params = useSearchParams()\r\n  const year = Number(params.get(\"year\"))\r\n  const type = params.get(\"type\") || \"income\"\r\n\r\n  const { transactions, loading } = useCashflowData(year)\r\n\r\n  const printedRef = useRef(false)\r\n\r\n  // ✅ PRINT ONLY ONCE\r\n  useEffect(() => {\r\n    if (!loading && !printedRef.current) {\r\n      printedRef.current = true\r\n      setTimeout(() => window.print(), 300)\r\n    }\r\n  }, [loading])\r\n\r\n  if (loading) return null\r\n\r\n  // =====================\r\n  // FILTER DATA\r\n  // =====================\r\n  const filtered =\r\n    type === \"expense\"\r\n      ? transactions.filter(t => (t.withdrawal || 0) > 0)\r\n      : transactions.filter(t => (t.deposit || 0) > 0)\r\n\r\n  // =====================\r\n  // GROUP BY MONTH\r\n  // =====================\r\n  const byMonth = {}\r\n  filtered.forEach(t => {\r\n    const m = new Date(t.date).getMonth()\r\n    if (!byMonth[m]) byMonth[m] = []\r\n    byMonth[m].push(t)\r\n  })\r\n\r\n  return (\r\n    <div className=\"print-root p-10 text-black\">\r\n\r\n      {/* ================= HEADER ================= */}\r\n      <div className=\"text-center mb-8\">\r\n        <h1 className=\"text-xl font-bold\">\r\n          BARANGAY TREASURER’S REPORT\r\n        </h1>\r\n        <p className=\"text-sm font-medium\">\r\n          {type === \"expense\" ? \"DISBURSEMENTS\" : \"INCOME COLLECTIONS\"} – {year}\r\n        </p>\r\n      </div>\r\n\r\n      {/* ================= BODY ================= */}\r\n      {Object.keys(byMonth).map((month) => {\r\n        const rows = byMonth[month]\r\n\r\n        // ---------- INCOME GROUPING ----------\r\n        let groupedIncome = {}\r\n        let total = 0\r\n\r\n        if (type === \"income\") {\r\n          rows.forEach(r => {\r\n            const cat = categorizeIncome(r.description)\r\n            groupedIncome[cat] = (groupedIncome[cat] || 0) + Number(r.deposit)\r\n            total += Number(r.deposit)\r\n          })\r\n        }\r\n\r\n        // ---------- EXPENSE TOTAL ----------\r\n        if (type === \"expense\") {\r\n          rows.forEach(r => total += Number(r.withdrawal))\r\n        }\r\n\r\n        return (\r\n          <div key={month} className=\"mb-10\">\r\n\r\n            <h2 className=\"font-bold mb-3\">\r\n              {MONTHS[month]} {year} {type === \"expense\" ? \"DISBURSEMENTS\" : \"COLLECTIONS\"}:\r\n            </h2>\r\n\r\n            {/* ===== INCOME FORMAT ===== */}\r\n            {type === \"income\" && Object.entries(groupedIncome).map(([label, value]) => (\r\n              <div key={label} className=\"flex justify-between text-sm mb-1\">\r\n                <span>{label}</span>\r\n                <span>{value.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span>\r\n              </div>\r\n            ))}\r\n\r\n            {/* ===== EXPENSE FORMAT (DIRECT) ===== */}\r\n            {type === \"expense\" && rows.map((r, i) => (\r\n              <div key={i} className=\"flex justify-between text-sm mb-1\">\r\n                <span>{r.description}</span>\r\n                <span>{Number(r.withdrawal).toLocaleString(undefined, { minimumFractionDigits: 2 })}</span>\r\n              </div>\r\n            ))}\r\n\r\n            {/* ===== TOTAL ===== */}\r\n            <div className=\"flex justify-between font-bold border-t mt-2 pt-2\">\r\n              <span>Total</span>\r\n              <span>{total.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span>\r\n            </div>\r\n\r\n          </div>\r\n        )\r\n      })}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}