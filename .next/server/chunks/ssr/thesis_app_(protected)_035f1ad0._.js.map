{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/expenses/components/budgetUpload.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect} from \"react\";\r\n\r\nimport { forwardRef, useImperativeHandle, useRef, useState } from \"react\";\r\nimport * as XLSX from \"xlsx\";\r\nimport { supabase } from \"../../../../lib/supabaseClient\";\r\n\r\nconst BudgetUploadPage = forwardRef(function BudgetUploadPage(\r\n  { mode = \"form\", selectedYear, onSuccess }, // üëà ADD onSuccess\r\n  ref\r\n) {\r\n\r\n  const fileInputRef = useRef(null);\r\n\r\n  const [category, setCategory] = useState(\"\");\r\n  const [description, setDescription] = useState(\"\");\r\n  const [amount, setAmount] = useState(\"\");\r\nconst [customCategory, setCustomCategory] = useState(\"\");\r\nconst [customDescription, setCustomDescription] = useState(\"\");\r\n\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    openFilePicker() {\r\n      fileInputRef.current?.click();\r\n    },\r\n  }));\r\nconst [previousCategories, setPreviousCategories] = useState([]);\r\nconst [previousDescriptions, setPreviousDescriptions] = useState([]);\r\n\r\nuseEffect(() => {\r\n  const loadCategories = async () => {\r\n    const { data, error } = await supabase\r\n      .from(\"budget_uploads\")\r\n      .select(\"category\")\r\n      .eq(\"year\", 2025);\r\n\r\n    if (!error && data) {\r\n      const unique = [...new Set(data.map(d => d.category))];\r\n      setPreviousCategories(unique);\r\n    }\r\n  };\r\n\r\n  loadCategories();\r\n}, [selectedYear]);\r\n\r\n\r\n\r\nuseEffect(() => {\r\n  if (!category || category === \"__new__\") {\r\n    setPreviousDescriptions([]);\r\n    return;\r\n  }\r\n\r\n  const loadDescriptions = async () => {\r\n    const { data, error } = await supabase\r\n      .from(\"budget_uploads\")\r\n      .select(\"description\")\r\n      .eq(\"year\", 2025)\r\n      .eq(\"category\", category);\r\n\r\n    if (!error && data) {\r\n      const unique = [...new Set(data.map(d => d.description))];\r\n      setPreviousDescriptions(unique);\r\n    }\r\n  };\r\n\r\n  loadDescriptions();\r\n}, [category]);\r\n\r\n  /* ================= FILE UPLOAD ================= */\r\n  const handleFile = async (file) => {\r\n    if (!file) return;\r\n\r\n    try {\r\n      let records = [];\r\n\r\n      if (file.name.endsWith(\".csv\")) {\r\n        const text = await file.text();\r\n        const rows = text.trim().split(/\\r?\\n/).slice(1);\r\n        records = rows.map((row) => {\r\n          const r = row.split(\",\");\r\n          return {\r\n            year: Number(r[0]),\r\n            category: r[1],\r\n            description: r[2],\r\n            amount: Number(r[3]),\r\n          };\r\n        });\r\n      }\r\n\r\n      if (file.name.endsWith(\".xlsx\")) {\r\n        const buffer = await file.arrayBuffer();\r\n        const wb = XLSX.read(buffer, { type: \"array\" });\r\n        const sheet = wb.Sheets[wb.SheetNames[0]];\r\n        const json = XLSX.utils.sheet_to_json(sheet, { defval: \"\" });\r\n\r\n        records = json.map((row) => ({\r\n  year: selectedYear, // ‚úÖ FORCE DASHBOARD YEAR\r\n  category: row.category,\r\n  description: row.description,\r\n  amount: Number(row.amount),\r\n}));\r\n\r\n      }\r\n\r\n      await supabase\r\n        .from(\"budget_uploads\")\r\n        .upsert(records, { onConflict: \"year,category,description\" });\r\nonSuccess?.(); \r\n      alert(`‚úÖ Uploaded ${records.length} rows`);\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert(\"‚ùå Upload failed\");\r\n    }\r\n  };\r\n\r\n  const handleManualSubmit = async () => {\r\n  const finalCategory =\r\n    category === \"__new__\" ? customCategory.trim() : category;\r\n\r\n  const finalDescription =\r\n    description === \"__new__\"\r\n      ? customDescription.trim()\r\n      : description;\r\n\r\n  if (!finalCategory || !finalDescription || !amount) {\r\n    alert(\"‚ùå Please complete all fields.\");\r\n    return;\r\n  }\r\n\r\n  if (finalCategory === \"__new__\" || finalDescription === \"__new__\") {\r\n    alert(\"‚ùå Invalid category or description.\");\r\n    return;\r\n  }\r\n\r\n  const record = {\r\n    year: selectedYear,\r\n    category: finalCategory,        // ‚úÖ CORRECT VALUE\r\n    description: finalDescription,  // ‚úÖ CORRECT VALUE\r\n    amount: Number(amount),\r\n  };\r\n\r\n  const { error } = await supabase\r\n    .from(\"budget_uploads\")\r\n    .upsert(record, {\r\n      onConflict: \"year,category,description\",\r\n    });\r\n\r\n  if (error) {\r\n    console.error(error);\r\n    alert(\"‚ùå Failed to save record\");\r\n    return;\r\n  }\r\n\r\n  alert(\"‚úÖ Budget item saved\");\r\n\r\n  setCategory(\"\");\r\n  setCustomCategory(\"\");\r\n  setDescription(\"\");\r\n  setCustomDescription(\"\");\r\n  setAmount(\"\");\r\n\r\n  onSuccess?.();\r\n};\r\n\r\n return (\r\n  <>\r\n    {/* ALWAYS RENDER FILE INPUT (HIDDEN) */}\r\n    <input\r\n      ref={fileInputRef}\r\n      type=\"file\"\r\n      accept=\".csv,.xlsx\"\r\n      className=\"hidden\"\r\n      onChange={(e) => handleFile(e.target.files?.[0])}\r\n    />\r\n\r\n    {/* ================= PICKER MODE ================= */}\r\n    {mode === \"picker\" && (\r\n      <div\r\n        className=\"min-h-[220px] flex flex-col items-center justify-center\r\n                   rounded-lg border-2 border-dashed border-slate-300\r\n                   bg-slate-50 p-8 text-center\"\r\n      >\r\n        <p className=\"mb-4 text-sm text-slate-600\">\r\n          Upload a CSV or Excel file\r\n        </p>\r\n\r\n        <button\r\n          onClick={() => fileInputRef.current?.click()}\r\n          className=\"rounded-lg bg-emerald-600 px-6 py-2.5 text-sm font-semibold\r\n                     text-white hover:bg-emerald-700 transition\"\r\n        >\r\n          üìÅ Choose File\r\n        </button>\r\n\r\n        <p className=\"mt-3 text-xs text-slate-400\">\r\n          Supported formats: .csv, .xlsx\r\n        </p>\r\n      </div>\r\n    )}\r\n\r\n    {/* ================= FORM MODE ================= */}\r\n    {mode === \"form\" && (\r\n      <div className=\"space-y-4\">\r\n        {/* CATEGORY */}\r\n        <div>\r\n          <label className=\"text-xs font-medium text-slate-600\">\r\n            Category\r\n          </label>\r\n\r\n          <select\r\n            value={category}\r\n            onChange={(e) => {\r\n              setCategory(e.target.value);\r\n              if (e.target.value !== \"__new__\") {\r\n                setCustomCategory(\"\");\r\n              }\r\n            }}\r\n            className=\"border rounded px-3 py-2 text-sm w-full\"\r\n          >\r\n            <option value=\"\">Select Category</option>\r\n\r\n            {previousCategories.map((c) => (\r\n              <option key={c} value={c}>\r\n                {c}\r\n              </option>\r\n            ))}\r\n\r\n            <option value=\"__new__\">‚ûï Add new category</option>\r\n          </select>\r\n\r\n          {category === \"__new__\" && (\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Enter new category\"\r\n              value={customCategory}\r\n              onChange={(e) => setCustomCategory(e.target.value)}\r\n              className=\"border rounded px-3 py-2 text-sm w-full mt-1\"\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {/* DESCRIPTION */}\r\n        <div>\r\n          <label className=\"text-xs font-medium text-slate-600\">\r\n            Description\r\n          </label>\r\n\r\n          {previousDescriptions.length > 0 && (\r\n            <select\r\n              value={description}\r\n              onChange={(e) => setDescription(e.target.value)}\r\n              className=\"border rounded px-3 py-2 text-sm w-full\"\r\n            >\r\n              <option value=\"\">Select Description</option>\r\n\r\n              {previousDescriptions.map((d) => (\r\n                <option key={d} value={d}>\r\n                  {d}\r\n                </option>\r\n              ))}\r\n\r\n              <option value=\"__new__\">‚ûï Add new description</option>\r\n            </select>\r\n          )}\r\n\r\n          {(description === \"__new__\" ||\r\n            previousDescriptions.length === 0) && (\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Enter description\"\r\n              value={customDescription}\r\n              onChange={(e) => setCustomDescription(e.target.value)}\r\n              className=\"border rounded px-3 py-2 text-sm w-full mt-1\"\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {/* AMOUNT */}\r\n        <div>\r\n          <label className=\"text-xs font-medium text-slate-600\">\r\n            Amount\r\n          </label>\r\n          <input\r\n            type=\"number\"\r\n            value={amount}\r\n            onChange={(e) => setAmount(e.target.value)}\r\n            placeholder=\"Amount\"\r\n            className=\"border rounded px-3 py-2 text-sm w-full\"\r\n          />\r\n        </div>\r\n\r\n        {/* SAVE BUTTON */}\r\n        <div className=\"flex justify-end\">\r\n          <button\r\n            onClick={handleManualSubmit}\r\n            className=\"bg-emerald-600 text-white px-4 py-2 rounded-lg\r\n                       font-semibold hover:bg-emerald-700\"\r\n          >\r\n            üíæ Save Budget Item\r\n          </button>\r\n        </div>\r\n      </div>\r\n    )}\r\n  </>\r\n);\r\n});\r\n  \r\nexport default BudgetUploadPage;\r\n"],"names":[],"mappings":";;;;;AAEA;AAGA;AACA;AANA;;;;;;AAQA,MAAM,iCAAmB,IAAA,6NAAU,EAAC,SAAS,iBAC3C,EAAE,OAAO,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,EAC1C,GAAG;IAGH,MAAM,eAAe,IAAA,yNAAM,EAAC;IAE5B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,2NAAQ,EAAC;IACzC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,2NAAQ,EAAC;IAC/C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,2NAAQ,EAAC;IACvC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,2NAAQ,EAAC;IACrD,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,2NAAQ,EAAC;IAGzD,IAAA,sOAAmB,EAAC,KAAK,IAAM,CAAC;YAC9B;gBACE,aAAa,OAAO,EAAE;YACxB;QACF,CAAC;IACH,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,2NAAQ,EAAC,EAAE;IAC/D,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,2NAAQ,EAAC,EAAE;IAEnE,IAAA,4NAAS,EAAC;QACR,MAAM,iBAAiB;YACrB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,kBACL,MAAM,CAAC,YACP,EAAE,CAAC,QAAQ;YAEd,IAAI,CAAC,SAAS,MAAM;gBAClB,MAAM,SAAS;uBAAI,IAAI,IAAI,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ;iBAAG;gBACtD,sBAAsB;YACxB;QACF;QAEA;IACF,GAAG;QAAC;KAAa;IAIjB,IAAA,4NAAS,EAAC;QACR,IAAI,CAAC,YAAY,aAAa,WAAW;YACvC,wBAAwB,EAAE;YAC1B;QACF;QAEA,MAAM,mBAAmB;YACvB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,kBACL,MAAM,CAAC,eACP,EAAE,CAAC,QAAQ,MACX,EAAE,CAAC,YAAY;YAElB,IAAI,CAAC,SAAS,MAAM;gBAClB,MAAM,SAAS;uBAAI,IAAI,IAAI,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW;iBAAG;gBACzD,wBAAwB;YAC1B;QACF;QAEA;IACF,GAAG;QAAC;KAAS;IAEX,mDAAmD,GACnD,MAAM,aAAa,OAAO;QACxB,IAAI,CAAC,MAAM;QAEX,IAAI;YACF,IAAI,UAAU,EAAE;YAEhB,IAAI,KAAK,IAAI,CAAC,QAAQ,CAAC,SAAS;gBAC9B,MAAM,OAAO,MAAM,KAAK,IAAI;gBAC5B,MAAM,OAAO,KAAK,IAAI,GAAG,KAAK,CAAC,SAAS,KAAK,CAAC;gBAC9C,UAAU,KAAK,GAAG,CAAC,CAAC;oBAClB,MAAM,IAAI,IAAI,KAAK,CAAC;oBACpB,OAAO;wBACL,MAAM,OAAO,CAAC,CAAC,EAAE;wBACjB,UAAU,CAAC,CAAC,EAAE;wBACd,aAAa,CAAC,CAAC,EAAE;wBACjB,QAAQ,OAAO,CAAC,CAAC,EAAE;oBACrB;gBACF;YACF;YAEA,IAAI,KAAK,IAAI,CAAC,QAAQ,CAAC,UAAU;gBAC/B,MAAM,SAAS,MAAM,KAAK,WAAW;gBACrC,MAAM,KAAK,+IAAS,CAAC,QAAQ;oBAAE,MAAM;gBAAQ;gBAC7C,MAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,UAAU,CAAC,EAAE,CAAC;gBACzC,MAAM,OAAO,gJAAU,CAAC,aAAa,CAAC,OAAO;oBAAE,QAAQ;gBAAG;gBAE1D,UAAU,KAAK,GAAG,CAAC,CAAC,MAAQ,CAAC;wBACnC,MAAM;wBACN,UAAU,IAAI,QAAQ;wBACtB,aAAa,IAAI,WAAW;wBAC5B,QAAQ,OAAO,IAAI,MAAM;oBAC3B,CAAC;YAEK;YAEA,MAAM,2IAAQ,CACX,IAAI,CAAC,kBACL,MAAM,CAAC,SAAS;gBAAE,YAAY;YAA4B;YACnE;YACM,MAAM,CAAC,WAAW,EAAE,QAAQ,MAAM,CAAC,KAAK,CAAC;QAC3C,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC;YACd,MAAM;QACR;IACF;IAEA,MAAM,qBAAqB;QAC3B,MAAM,gBACJ,aAAa,YAAY,eAAe,IAAI,KAAK;QAEnD,MAAM,mBACJ,gBAAgB,YACZ,kBAAkB,IAAI,KACtB;QAEN,IAAI,CAAC,iBAAiB,CAAC,oBAAoB,CAAC,QAAQ;YAClD,MAAM;YACN;QACF;QAEA,IAAI,kBAAkB,aAAa,qBAAqB,WAAW;YACjE,MAAM;YACN;QACF;QAEA,MAAM,SAAS;YACb,MAAM;YACN,UAAU;YACV,aAAa;YACb,QAAQ,OAAO;QACjB;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CAC7B,IAAI,CAAC,kBACL,MAAM,CAAC,QAAQ;YACd,YAAY;QACd;QAEF,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC;YACd,MAAM;YACN;QACF;QAEA,MAAM;QAEN,YAAY;QACZ,kBAAkB;QAClB,eAAe;QACf,qBAAqB;QACrB,UAAU;QAEV;IACF;IAEC,qBACC;;0BAEE,wPAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,WAAU;gBACV,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;;;;;;YAIhD,SAAS,0BACR,wPAAC;gBACC,WAAU;;kCAIV,wPAAC;wBAAE,WAAU;kCAA8B;;;;;;kCAI3C,wPAAC;wBACC,SAAS,IAAM,aAAa,OAAO,EAAE;wBACrC,WAAU;kCAEX;;;;;;kCAID,wPAAC;wBAAE,WAAU;kCAA8B;;;;;;;;;;;;YAO9C,SAAS,wBACR,wPAAC;gBAAI,WAAU;;kCAEb,wPAAC;;0CACC,wPAAC;gCAAM,WAAU;0CAAqC;;;;;;0CAItD,wPAAC;gCACC,OAAO;gCACP,UAAU,CAAC;oCACT,YAAY,EAAE,MAAM,CAAC,KAAK;oCAC1B,IAAI,EAAE,MAAM,CAAC,KAAK,KAAK,WAAW;wCAChC,kBAAkB;oCACpB;gCACF;gCACA,WAAU;;kDAEV,wPAAC;wCAAO,OAAM;kDAAG;;;;;;oCAEhB,mBAAmB,GAAG,CAAC,CAAC,kBACvB,wPAAC;4CAAe,OAAO;sDACpB;2CADU;;;;;kDAKf,wPAAC;wCAAO,OAAM;kDAAU;;;;;;;;;;;;4BAGzB,aAAa,2BACZ,wPAAC;gCACC,MAAK;gCACL,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,kBAAkB,EAAE,MAAM,CAAC,KAAK;gCACjD,WAAU;;;;;;;;;;;;kCAMhB,wPAAC;;0CACC,wPAAC;gCAAM,WAAU;0CAAqC;;;;;;4BAIrD,qBAAqB,MAAM,GAAG,mBAC7B,wPAAC;gCACC,OAAO;gCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;gCAC9C,WAAU;;kDAEV,wPAAC;wCAAO,OAAM;kDAAG;;;;;;oCAEhB,qBAAqB,GAAG,CAAC,CAAC,kBACzB,wPAAC;4CAAe,OAAO;sDACpB;2CADU;;;;;kDAKf,wPAAC;wCAAO,OAAM;kDAAU;;;;;;;;;;;;4BAI3B,CAAC,gBAAgB,aAChB,qBAAqB,MAAM,KAAK,CAAC,mBACjC,wPAAC;gCACC,MAAK;gCACL,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,qBAAqB,EAAE,MAAM,CAAC,KAAK;gCACpD,WAAU;;;;;;;;;;;;kCAMhB,wPAAC;;0CACC,wPAAC;gCAAM,WAAU;0CAAqC;;;;;;0CAGtD,wPAAC;gCACC,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;gCACzC,aAAY;gCACZ,WAAU;;;;;;;;;;;;kCAKd,wPAAC;wBAAI,WAAU;kCACb,cAAA,wPAAC;4BACC,SAAS;4BACT,WAAU;sCAEX;;;;;;;;;;;;;;;;;;;AAQX;uCAEe","debugId":null}},
    {"offset": {"line": 376, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/dashboard/components/expensePieChart.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport {\r\n  PieChart,\r\n  Pie,\r\n  Cell,\r\n  Tooltip,\r\n  ResponsiveContainer,\r\n} from \"recharts\";\r\n\r\nconst expenseCOLORS = [\r\n  \"#ef4444\", \"#f97316\", \"#eab308\", \"#84cc16\", \"#22c55e\",\r\n  \"#0ea5e9\", \"#6366f1\", \"#a855f7\", \"#ec4899\", \"#14b8a6\"\r\n];\r\n\r\n// --- COA-COMPLIANT EXPENSE CATEGORIZER ---\r\nexport function categorizeExpense(description = \"\") {\r\n  const t = description.toLowerCase();\r\n\r\n  if (\r\n    t.includes(\"hon.\") ||\r\n    t.includes(\"honor\") ||\r\n    t.includes(\"appointed\") ||\r\n    t.includes(\"elected\") ||\r\n    t.includes(\"tanod\") ||\r\n    t.includes(\"bhw\") ||\r\n    t.includes(\"chief\")\r\n  ) return \"PS (Personal Services)\";\r\n\r\n  if (t.includes(\"sk\")) return \"10% SK Fund\";\r\n\r\n  if (\r\n    t.includes(\"fire\") ||\r\n    t.includes(\"safety drill\") ||\r\n    t.includes(\"disaster\") ||\r\n    t.includes(\"rescue\") ||\r\n    t.includes(\"drrm\")\r\n  ) return \"5% BDRRM Fund\";\r\n\r\n  if (\r\n    t.includes(\"women\") ||\r\n    t.includes(\"senior\") ||\r\n    t.includes(\"pwd\") ||\r\n    t.includes(\"nutrition\") ||\r\n    t.includes(\"feeding\") ||\r\n    t.includes(\"deworm\") ||\r\n    t.includes(\"gap\")\r\n  ) return \"GAD Programs\";\r\n\r\n  if (\r\n    t.includes(\"construction\") ||\r\n    t.includes(\"improvement\") ||\r\n    t.includes(\"materials\") ||\r\n    t.includes(\"solar\") ||\r\n    t.includes(\"equipment\") ||\r\n    t.includes(\"road\") ||\r\n    t.includes(\"building\") ||\r\n    t.includes(\"water system\") ||\r\n    t.includes(\"rehab\")\r\n  ) return \"20% BDF / Capital Outlay\";\r\n\r\n  if (\r\n    t.includes(\"travel\") ||\r\n    t.includes(\"seminar\") ||\r\n    t.includes(\"training\") ||\r\n    t.includes(\"supplies\") ||\r\n    t.includes(\"office\") ||\r\n    t.includes(\"water\") ||\r\n    t.includes(\"electric\") ||\r\n    t.includes(\"bond\") ||\r\n    t.includes(\"security\") ||\r\n    t.includes(\"bookkeeper\") ||\r\n    t.includes(\"lumber\") ||\r\n    t.includes(\"fuel\") ||\r\n    t.includes(\"diesel\") ||\r\n    t.includes(\"registration\") ||\r\n    t.includes(\"check book\") ||\r\n    t.includes(\"maintenance\") ||\r\n    t.includes(\"interest\") ||\r\n    t.includes(\"tax\") ||\r\n    t.includes(\"pcf\")\r\n  ) return \"MOOE\";\r\n\r\n  return \"Other / Non-Office\";\r\n}\r\n\r\nexport default function ExpensePieChart({ transactions }) {\r\n  const expenseTx = transactions.filter(t => t.withdrawal > 0);\r\n\r\n  // =========================\r\n  // GROUP EXPENSES\r\n  // =========================\r\n  const grouped = {};\r\n  expenseTx.forEach(t => {\r\n    const category = categorizeExpense(t.description || \"\");\r\n    grouped[category] = (grouped[category] || 0) + Number(t.withdrawal);\r\n  });\r\n\r\n  // =========================\r\n  // BUILD STABLE CHART DATA\r\n  // =========================\r\n  const chartData = Object.entries(grouped).map(\r\n    ([name, value]) => ({ name, value })\r\n  );\r\n\r\n  // =========================\r\n  // STABLE COLOR MAP (KEY FIX)\r\n  // =========================\r\n  const colorMap = {};\r\n  chartData.forEach((item, index) => {\r\n    colorMap[item.name] =\r\n      expenseCOLORS[index % expenseCOLORS.length];\r\n  });\r\n\r\n  return (\r\n<div className=\"w-full flex flex-col items-center gap-8\">\r\n      {/* PIE */}\r\n      <div className=\"w-[260px]\">\r\n        <ResponsiveContainer width=\"100%\" aspect={1}>\r\n          <PieChart>\r\n            <Pie\r\n              data={chartData}\r\n              cx=\"50%\"\r\n              cy=\"50%\"\r\n              outerRadius=\"80%\"\r\n              dataKey=\"value\"\r\n              label={false}\r\n              labelLine={false}\r\n            >\r\n              {chartData.map((item) => (\r\n                <Cell\r\n                  key={item.name}\r\n                  fill={colorMap[item.name]}\r\n                />\r\n              ))}\r\n            </Pie>\r\n\r\n            <Tooltip />\r\n          </PieChart>\r\n        </ResponsiveContainer>\r\n      </div>\r\n\r\n     {/* CUSTOM LEGEND */}\r\n<div className=\"mt-4 w-full max-w-xs space-y-2 flex flex-col items-start text-left\">\r\n  {chartData.map((item) => (\r\n    <div\r\n      key={item.name}\r\n      className=\"flex items-center gap-2 text-m\"\r\n    >\r\n      <span\r\n        className=\"w-3 h-3 rounded-sm\"\r\n        style={{ backgroundColor: colorMap[item.name] }}\r\n      />\r\n      <span className=\"text-gray-700\">\r\n        {item.name}\r\n      </span>\r\n    </div>\r\n  ))}\r\n</div>\r\n\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAFA;;;AAUA,MAAM,gBAAgB;IACpB;IAAW;IAAW;IAAW;IAAW;IAC5C;IAAW;IAAW;IAAW;IAAW;CAC7C;AAGM,SAAS,kBAAkB,cAAc,EAAE;IAChD,MAAM,IAAI,YAAY,WAAW;IAEjC,IACE,EAAE,QAAQ,CAAC,WACX,EAAE,QAAQ,CAAC,YACX,EAAE,QAAQ,CAAC,gBACX,EAAE,QAAQ,CAAC,cACX,EAAE,QAAQ,CAAC,YACX,EAAE,QAAQ,CAAC,UACX,EAAE,QAAQ,CAAC,UACX,OAAO;IAET,IAAI,EAAE,QAAQ,CAAC,OAAO,OAAO;IAE7B,IACE,EAAE,QAAQ,CAAC,WACX,EAAE,QAAQ,CAAC,mBACX,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,aACX,EAAE,QAAQ,CAAC,SACX,OAAO;IAET,IACE,EAAE,QAAQ,CAAC,YACX,EAAE,QAAQ,CAAC,aACX,EAAE,QAAQ,CAAC,UACX,EAAE,QAAQ,CAAC,gBACX,EAAE,QAAQ,CAAC,cACX,EAAE,QAAQ,CAAC,aACX,EAAE,QAAQ,CAAC,QACX,OAAO;IAET,IACE,EAAE,QAAQ,CAAC,mBACX,EAAE,QAAQ,CAAC,kBACX,EAAE,QAAQ,CAAC,gBACX,EAAE,QAAQ,CAAC,YACX,EAAE,QAAQ,CAAC,gBACX,EAAE,QAAQ,CAAC,WACX,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,mBACX,EAAE,QAAQ,CAAC,UACX,OAAO;IAET,IACE,EAAE,QAAQ,CAAC,aACX,EAAE,QAAQ,CAAC,cACX,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,aACX,EAAE,QAAQ,CAAC,YACX,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,WACX,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,iBACX,EAAE,QAAQ,CAAC,aACX,EAAE,QAAQ,CAAC,WACX,EAAE,QAAQ,CAAC,aACX,EAAE,QAAQ,CAAC,mBACX,EAAE,QAAQ,CAAC,iBACX,EAAE,QAAQ,CAAC,kBACX,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,UACX,EAAE,QAAQ,CAAC,QACX,OAAO;IAET,OAAO;AACT;AAEe,SAAS,gBAAgB,EAAE,YAAY,EAAE;IACtD,MAAM,YAAY,aAAa,MAAM,CAAC,CAAA,IAAK,EAAE,UAAU,GAAG;IAE1D,4BAA4B;IAC5B,iBAAiB;IACjB,4BAA4B;IAC5B,MAAM,UAAU,CAAC;IACjB,UAAU,OAAO,CAAC,CAAA;QAChB,MAAM,WAAW,kBAAkB,EAAE,WAAW,IAAI;QACpD,OAAO,CAAC,SAAS,GAAG,CAAC,OAAO,CAAC,SAAS,IAAI,CAAC,IAAI,OAAO,EAAE,UAAU;IACpE;IAEA,4BAA4B;IAC5B,0BAA0B;IAC1B,4BAA4B;IAC5B,MAAM,YAAY,OAAO,OAAO,CAAC,SAAS,GAAG,CAC3C,CAAC,CAAC,MAAM,MAAM,GAAK,CAAC;YAAE;YAAM;QAAM,CAAC;IAGrC,4BAA4B;IAC5B,6BAA6B;IAC7B,4BAA4B;IAC5B,MAAM,WAAW,CAAC;IAClB,UAAU,OAAO,CAAC,CAAC,MAAM;QACvB,QAAQ,CAAC,KAAK,IAAI,CAAC,GACjB,aAAa,CAAC,QAAQ,cAAc,MAAM,CAAC;IAC/C;IAEA,qBACF,wPAAC;QAAI,WAAU;;0BAET,wPAAC;gBAAI,WAAU;0BACb,cAAA,wPAAC,oMAAmB;oBAAC,OAAM;oBAAO,QAAQ;8BACxC,cAAA,wPAAC,0KAAQ;;0CACP,wPAAC,gKAAG;gCACF,MAAM;gCACN,IAAG;gCACH,IAAG;gCACH,aAAY;gCACZ,SAAQ;gCACR,OAAO;gCACP,WAAW;0CAEV,UAAU,GAAG,CAAC,CAAC,qBACd,wPAAC,sKAAI;wCAEH,MAAM,QAAQ,CAAC,KAAK,IAAI,CAAC;uCADpB,KAAK,IAAI;;;;;;;;;;0CAMpB,wPAAC,4KAAO;;;;;;;;;;;;;;;;;;;;;0BAMpB,wPAAC;gBAAI,WAAU;0BACZ,UAAU,GAAG,CAAC,CAAC,qBACd,wPAAC;wBAEC,WAAU;;0CAEV,wPAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,iBAAiB,QAAQ,CAAC,KAAK,IAAI,CAAC;gCAAC;;;;;;0CAEhD,wPAAC;gCAAK,WAAU;0CACb,KAAK,IAAI;;;;;;;uBARP,KAAK,IAAI;;;;;;;;;;;;;;;;AAgBpB","debugId":null}},
    {"offset": {"line": 533, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/expenses/components/AllocationBarChart.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip,\r\n  ResponsiveContainer,\r\n  Legend,\r\n  CartesianGrid,\r\n} from \"recharts\";\r\n\r\nexport default function AllocationBarChart({ chartData }) {\r\n  return (\r\n  <div className=\"\">\r\n    {/* SECTION HEADER */}\r\n    <div className=\"flex items-center justify-between\">\r\n      <h2 className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\r\n      </h2>\r\n    </div>\r\n\r\n    {/* CHART CONTAINER */}\r\n    <div className=\"rounded-xl border border-slate-200 bg-white p-5 shadow-sm\">\r\n      <ResponsiveContainer width=\"100%\" height={260}>\r\n        <BarChart\r\n          data={chartData}\r\n          barGap={12}\r\n          margin={{ top: 10, right: 20, left: 0, bottom: 10 }}\r\n        >\r\n          {/* GRID */}\r\n          <CartesianGrid\r\n            strokeDasharray=\"3 3\"\r\n            vertical={false}\r\n            stroke=\"#e5e7eb\"\r\n          />\r\n\r\n          {/* AXES */}\r\n          <XAxis\r\n            dataKey=\"category\"\r\n            tick={{ fill: \"#64748b\", fontSize: 12 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n          />\r\n          <YAxis\r\n            tick={{ fill: \"#64748b\", fontSize: 12 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n          />\r\n\r\n          {/* TOOLTIP */}\r\n          <Tooltip\r\n            formatter={(v) => `‚Ç±${Number(v).toLocaleString()}`}\r\n            contentStyle={{\r\n              borderRadius: \"8px\",\r\n              borderColor: \"#e5e7eb\",\r\n              fontSize: \"12px\",\r\n            }}\r\n          />\r\n\r\n          {/* LEGEND */}\r\n          <Legend\r\n            verticalAlign=\"top\"\r\n            align=\"right\"\r\n            iconType=\"circle\"\r\n            wrapperStyle={{ fontSize: \"12px\", paddingBottom: 10 }}\r\n          />\r\n\r\n          {/* BARS */}\r\n          <Bar\r\n            dataKey=\"allocated\"\r\n            name=\"Allocated\"\r\n            fill=\"#10b981\"\r\n            radius={[6, 6, 0, 0]}\r\n          />\r\n          <Bar\r\n            dataKey=\"spent\"\r\n            name=\"Spent\"\r\n            fill=\"#ef4444\"\r\n            radius={[6, 6, 0, 0]}\r\n          />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  </div>\r\n);\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;;;AAae,SAAS,mBAAmB,EAAE,SAAS,EAAE;IACtD,qBACA,wPAAC;QAAI,WAAU;;0BAEb,wPAAC;gBAAI,WAAU;0BACb,cAAA,wPAAC;oBAAG,WAAU;;;;;;;;;;;0BAKhB,wPAAC;gBAAI,WAAU;0BACb,cAAA,wPAAC,oMAAmB;oBAAC,OAAM;oBAAO,QAAQ;8BACxC,cAAA,wPAAC,0KAAQ;wBACP,MAAM;wBACN,QAAQ;wBACR,QAAQ;4BAAE,KAAK;4BAAI,OAAO;4BAAI,MAAM;4BAAG,QAAQ;wBAAG;;0CAGlD,wPAAC,wLAAa;gCACZ,iBAAgB;gCAChB,UAAU;gCACV,QAAO;;;;;;0CAIT,wPAAC,wKAAK;gCACJ,SAAQ;gCACR,MAAM;oCAAE,MAAM;oCAAW,UAAU;gCAAG;gCACtC,UAAU;gCACV,UAAU;;;;;;0CAEZ,wPAAC,wKAAK;gCACJ,MAAM;oCAAE,MAAM;oCAAW,UAAU;gCAAG;gCACtC,UAAU;gCACV,UAAU;;;;;;0CAIZ,wPAAC,4KAAO;gCACN,WAAW,CAAC,IAAM,CAAC,CAAC,EAAE,OAAO,GAAG,cAAc,IAAI;gCAClD,cAAc;oCACZ,cAAc;oCACd,aAAa;oCACb,UAAU;gCACZ;;;;;;0CAIF,wPAAC,0KAAM;gCACL,eAAc;gCACd,OAAM;gCACN,UAAS;gCACT,cAAc;oCAAE,UAAU;oCAAQ,eAAe;gCAAG;;;;;;0CAItD,wPAAC,oKAAG;gCACF,SAAQ;gCACR,MAAK;gCACL,MAAK;gCACL,QAAQ;oCAAC;oCAAG;oCAAG;oCAAG;iCAAE;;;;;;0CAEtB,wPAAC,oKAAG;gCACF,SAAQ;gCACR,MAAK;gCACL,MAAK;gCACL,QAAQ;oCAAC;oCAAG;oCAAG;oCAAG;iCAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOhC","debugId":null}},
    {"offset": {"line": 698, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/expenses/components/BudgetSummaryCards.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { memo, useMemo, useState } from \"react\";\r\n\r\n\r\nimport AllocationBarChart from \"../components/AllocationBarChart\";\r\n\r\nconst BudgetCard = memo(function BudgetCard({\r\n  category,\r\n  allocated,\r\n  isOpen,\r\n  onToggle,\r\n  items,\r\n  spentBySubcategory,\r\n  onEdit,\r\n  onDelete,\r\n}) {\r\n\r\n  const formattedAmount = useMemo(\r\n    () => `‚Ç±${allocated.toLocaleString()}`,\r\n    [allocated]\r\n  );\r\nconst [menuOpen, setMenuOpen] = useState(false);\r\n\r\n\r\nconst [selectedSubcategory, setSelectedSubcategory] = useState(null);\r\n\r\n  // Group items by description/subcategory for clickable sections\r\n  // 1Ô∏è‚É£ GROUP ITEMS FIRST\r\nconst groupedItems = useMemo(() => {\r\n  const groups = {};\r\n  items?.forEach((item) => {\r\n    const key = item.description || \"Uncategorized\";\r\n    if (!groups[key]) {\r\n      groups[key] = {\r\n        name: key,\r\n        items: [],\r\n        total: 0,\r\n      };\r\n    }\r\n    groups[key].items.push(item);\r\n    groups[key].total += Number(item.amount) || 0;\r\n  });\r\n  return Object.values(groups);\r\n}, [items]);\r\n\r\n// 2Ô∏è‚É£ NOW SAFE TO USE groupedItems\r\nconst selectedAllocated =\r\n  groupedItems.find(g => g.name === selectedSubcategory)?.total || 0;\r\n\r\nconst selectedSpent =\r\n  spentBySubcategory?.[selectedSubcategory] || 0;\r\n\r\n// 3Ô∏è‚É£ PREPARE CHART DATA\r\nconst subcategoryChartData = selectedSubcategory\r\n  ? [\r\n      {\r\n        category: selectedSubcategory,\r\n        allocated: selectedAllocated,\r\n        spent: selectedSpent,\r\n      },\r\n    ]\r\n  : [];\r\n console.log(\"Selected:\", selectedSubcategory);\r\nconsole.log(\"Spent Map:\", spentBySubcategory);\r\n\r\n  // Calculate allocation percentage for progress bar\r\n  const progressPercentage = useMemo(() => {\r\n    if (!items || items.length === 0) return 0;\r\n    return Math.min((items.length / 15) * 100, 100);\r\n  }, [items]);\r\n\r\n\r\n\r\n\r\n\r\n\r\nreturn (\r\n  <div\r\n    className={`relative rounded-xl border border-slate-200 bg-white transition-all duration-300\r\n      ${isOpen \r\n        ? \"shadow-lg ring-1 ring-slate-100\" \r\n        : \"shadow-sm hover:shadow-md hover:border-slate-300\"\r\n      }\r\n    `}\r\n  >\r\n    \r\n    {/* TOP RIGHT ACTIONS - Refined */}\r\n    <div className=\"absolute right-6 top-6 flex items-center gap-3\">\r\n      <span className=\"inline-flex items-center rounded-full bg-slate-50 border border-slate-200 px-3 py-1 text-xs font-medium text-slate-700\">\r\n        {items?.length || 0} Items\r\n      </span>\r\n\r\n      <div className=\"relative\">\r\n        <button\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setMenuOpen((prev) => !prev);\r\n          }}\r\n          className=\"rounded-lg p-2 text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition-colors\"\r\n        >\r\n          <svg className=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path d=\"M10 3a2 2 0 110-4 2 2 0 010 4zm0 8a2 2 0 110-4 2 2 0 010 4zm0 8a2 2 0 110-4 2 2 0 010 4z\" />\r\n          </svg>\r\n        </button>\r\n\r\n        {menuOpen && (\r\n          <div\r\n            className=\"absolute right-0 mt-2 w-48 rounded-lg border border-slate-200 bg-white shadow-xl z-50 overflow-hidden\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <button\r\n              onClick={() => {\r\n                setMenuOpen(false);\r\n                onEdit?.();\r\n              }}\r\n              className=\"w-full px-4 py-3 text-left text-sm font-medium text-slate-700 hover:bg-slate-50 border-b border-slate-100 transition-colors\"\r\n            >\r\n              Edit Category\r\n            </button>\r\n\r\n            <button\r\n              onClick={() => {\r\n                setMenuOpen(false);\r\n                onDelete?.();\r\n              }}\r\n              className=\"w-full px-4 py-3 text-left text-sm font-medium text-red-600 hover:bg-red-50 transition-colors\"\r\n            >\r\n              Delete Category\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n\r\n{/* HEADER - Professional & Compact */}\r\n<div className=\"p-5\">\r\n  <div className=\"flex items-start justify-between\">\r\n    <div className=\"flex-1\">\r\n      {/* CATEGORY HEADER - Professional */}\r\n      <div className=\"flex items-center gap-3 mb-4\">\r\n        <div className=\"h-10 w-12 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center\">\r\n          <span className=\"text-white text-lg font-bold\">\r\n            {category.charAt(0).toUpperCase()}\r\n          </span>\r\n        </div>\r\n        <div className=\"min-w-0 flex-1\">\r\n          <h3 className=\"text-lg font-bold text-slate-900 tracking-tight\">\r\n            {category}\r\n          </h3>\r\n          \r\n        </div>\r\n      </div>\r\n\r\n      {/* AMOUNT - Professional */}\r\n      <div className=\"mt-4\">\r\n        \r\n        <p className=\"text-2xl font-bold text-slate-900\">\r\n          {formattedAmount}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  {/* ACTION BUTTON - Professional */}\r\n  <div className=\"mt-5 pt-4 border-t border-gray-100\">\r\n    <button\r\n      onClick={onToggle}\r\n      className={`w-full flex items-center justify-center gap-2 rounded-lg px-3 py-2.5 text-sm font-medium transition-all duration-200\r\n        ${isOpen\r\n          ? \"bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200\"\r\n          : \"bg-blue-50 text-emerald-700 hover:bg-emerald-100\"\r\n        }\r\n      `}\r\n    >\r\n      {isOpen ? (\r\n        <>\r\n          <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\r\n          </svg>\r\n          Hide Details\r\n        </>\r\n      ) : (\r\n        <>\r\n          <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n          </svg>\r\n          View Breakdown\r\n        </>\r\n      )}\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n{/* DETAILS PANEL - Professional & Compact */}\r\n{isOpen && (\r\n  <div className=\"border-t border-gray-100 animate-fadeIn\">\r\n    <div className=\"p-5\">\r\n\r\n      {selectedSubcategory && (\r\n        <div className=\"mb-5\">\r\n          <div className=\"rounded-lg border border-gray-200 bg-gray-50 p-4\">\r\n            {/* Subcategory Header */}\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"h-2 w-2 rounded-full bg-emerald-500\"></div>\r\n                <h4 className=\"text-sm font-semibold text-gray-900 truncate\">\r\n                  {selectedSubcategory}\r\n                </h4>\r\n              </div>\r\n              <button\r\n                onClick={() => setSelectedSubcategory(null)}\r\n                className=\"text-gray-400 hover:text-gray-600 text-xs p-1\"\r\n                aria-label=\"Close subcategory\"\r\n              >\r\n                <svg className=\"h-3 w-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            {/* SUMMARY - Professional */}\r\n            <div className=\"grid grid-cols-2 gap-2 mb-3\">\r\n              <div className=\"bg-white rounded border border-gray-200 p-3\">\r\n                <div className=\"flex items-center gap-1.5 mb-1\">\r\n                  <div className=\"h-1.5 w-1.5 rounded-full bg-emerald-500\"></div>\r\n                  <p className=\"text-xs font-medium text-gray-600\">Allocated</p>\r\n                </div>\r\n                <p className=\"text-base font-bold text-gray-900\">\r\n                  ‚Ç±{selectedAllocated.toLocaleString()}\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"bg-white rounded border border-gray-200 p-3\">\r\n                <div className=\"flex items-center gap-1.5 mb-1\">\r\n                  <div className=\"h-1.5 w-1.5 rounded-full bg-amber-500\"></div>\r\n                  <p className=\"text-xs font-medium text-gray-600\">Spent</p>\r\n                </div>\r\n                <p className=\"text-base font-bold text-gray-900\">\r\n                  ‚Ç±{selectedSpent.toLocaleString()}\r\n                </p>\r\n                <div className={`text-xs font-medium mt-1 ${selectedSpent > selectedAllocated ? 'text-red-600' : 'text-green-600'}`}>\r\n                  {selectedSpent > selectedAllocated \r\n                    ? `+${((selectedSpent - selectedAllocated) / selectedAllocated * 100).toFixed(1)}%`\r\n                    : `${((selectedAllocated - selectedSpent) / selectedAllocated * 100).toFixed(1)}% remaining`\r\n                  }\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* CHART */}\r\n            <div className=\"mb-3\">\r\n              <div className=\"flex items-center justify-between mb-1.5\">\r\n                <p className=\"text-xs font-medium text-gray-700\">Utilization</p>\r\n                <span className=\"text-xs text-gray-500\">\r\n                  {((selectedSpent / selectedAllocated) * 100).toFixed(0)}% spent\r\n                </span>\r\n              </div>\r\n              <div className=\"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden\">\r\n                <div \r\n                  className=\"h-full bg-blue-500 rounded-full\"\r\n                  style={{ width: `${Math.min((selectedSpent / selectedAllocated) * 100, 100)}%` }}\r\n                ></div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* WARNING - Professional */}\r\n            {selectedSpent > selectedAllocated && (\r\n              <div className=\"rounded border border-red-200 bg-red-50 p-2.5\">\r\n                <div className=\"flex items-start gap-2\">\r\n                  <svg className=\"h-3 w-3 text-red-600 mt-0.5 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                  <div>\r\n                    <p className=\"text-xs font-semibold text-red-800 mb-0.5\">Budget Exceeded</p>\r\n                    <p className=\"text-xs text-red-700\">\r\n                      Overspent by ‚Ç±{(selectedSpent - selectedAllocated).toLocaleString()}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* SUBCATEGORIES SECTION - Professional */}\r\n      <div className=\"mb-4\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h4 className=\"text-sm font-semibold text-gray-900\">Subcategories</h4>\r\n          <span className=\"text-xs text-gray-500\">{groupedItems.length} total</span>\r\n        </div>\r\n        \r\n        <div className=\"space-y-2\">\r\n          {groupedItems.length > 0 ? (\r\n            groupedItems.map((group, groupIndex) => (\r\n              <div\r\n                key={groupIndex}\r\n                className={`border border-gray-200 rounded-md transition-colors cursor-pointer\r\n                  ${selectedSubcategory === group.name\r\n                    ? 'border-blue-300 bg-blue-50'\r\n                    : 'hover:border-gray-300 bg-white'\r\n                  }\r\n                `}\r\n                onClick={() =>\r\n                  setSelectedSubcategory(\r\n                    selectedSubcategory === group.name ? null : group.name\r\n                  )\r\n                }\r\n              >\r\n                <div className=\"p-3\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n                      <div className={`h-6 w-6 rounded flex items-center justify-center text-xs font-medium\r\n                        ${selectedSubcategory === group.name\r\n                          ? 'bg-blue-100 text-blue-700'\r\n                          : 'bg-gray-100 text-gray-600'\r\n                        }\r\n                      `}>\r\n                        {groupIndex + 1}\r\n                      </div>\r\n                      <div className=\"min-w-0 flex-1\">\r\n                        <h5 className=\"text-sm font-medium text-gray-900 truncate\">\r\n                          {group.name}\r\n                        </h5>\r\n                      \r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 ml-2\">\r\n                      <span className=\"text-sm font-semibold text-gray-900 whitespace-nowrap\">\r\n                        ‚Ç±{group.total.toLocaleString()}\r\n                      </span>\r\n                      <svg \r\n                        className={`h-3 w-3 text-gray-400 transition-transform ${selectedSubcategory === group.name ? 'rotate-180' : ''}`}\r\n                        fill=\"none\" \r\n                        stroke=\"currentColor\" \r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                      </svg>\r\n                    </div>\r\n                  </div>\r\n\r\n                  \r\n                </div>\r\n              </div>\r\n            ))\r\n          ) : (\r\n            <div className=\"text-center py-6 rounded border border-dashed border-gray-300 bg-gray-50\">\r\n              <svg className=\"h-5 w-5 text-gray-400 mx-auto mb-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n              </svg>\r\n              <p className=\"text-sm text-gray-600\">No subcategories defined</p>\r\n              <p className=\"text-xs text-gray-500 mt-0.5\">Add budget items to see breakdown</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      \r\n    </div>\r\n  </div>\r\n)}\r\n  </div>\r\n);\r\n});\r\n\r\n\r\n\r\nexport default BudgetCard;"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1509, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/expenses/components/IncomeComparisonChart.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport {\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip,\r\n  Legend,\r\n  ResponsiveContainer,\r\n} from \"recharts\";\r\n\r\nexport default function IncomeComparisonChart({ data }) {\r\n  if (!data || data.length === 0) {\r\n    return (\r\n      <p className=\"text-sm italic text-slate-500\">\r\n        No income recorded for this year.\r\n      </p>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"h-[320px] w-full\">\r\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n        <BarChart data={data}>\r\n          <XAxis dataKey=\"category\" />\r\n          <YAxis />\r\n          <Tooltip\r\n            formatter={(v) =>\r\n              `‚Ç±${Number(v).toLocaleString()}`\r\n            }\r\n          />\r\n          <Legend />\r\n\r\n          <Bar\r\n            dataKey=\"approved\"\r\n            name=\"Approved Income\"\r\n            fill=\"#10b981\"\r\n            radius={[4, 4, 0, 0]}\r\n          />\r\n          <Bar\r\n            dataKey=\"actual\"\r\n            name=\"Actual Income\"\r\n            fill=\"#3b82f6\"\r\n            radius={[4, 4, 0, 0]}\r\n          />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;;;AAYe,SAAS,sBAAsB,EAAE,IAAI,EAAE;IACpD,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC9B,qBACE,wPAAC;YAAE,WAAU;sBAAgC;;;;;;IAIjD;IAEA,qBACE,wPAAC;QAAI,WAAU;kBACb,cAAA,wPAAC,oMAAmB;YAAC,OAAM;YAAO,QAAO;sBACvC,cAAA,wPAAC,0KAAQ;gBAAC,MAAM;;kCACd,wPAAC,wKAAK;wBAAC,SAAQ;;;;;;kCACf,wPAAC,wKAAK;;;;;kCACN,wPAAC,4KAAO;wBACN,WAAW,CAAC,IACV,CAAC,CAAC,EAAE,OAAO,GAAG,cAAc,IAAI;;;;;;kCAGpC,wPAAC,0KAAM;;;;;kCAEP,wPAAC,oKAAG;wBACF,SAAQ;wBACR,MAAK;wBACL,MAAK;wBACL,QAAQ;4BAAC;4BAAG;4BAAG;4BAAG;yBAAE;;;;;;kCAEtB,wPAAC,oKAAG;wBACF,SAAQ;wBACR,MAAK;wBACL,MAAK;wBACL,QAAQ;4BAAC;4BAAG;4BAAG;4BAAG;yBAAE;;;;;;;;;;;;;;;;;;;;;;AAMhC","debugId":null}},
    {"offset": {"line": 1618, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/expenses/page.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useMemo } from \"react\";\r\n\r\nimport { useSearchParams } from \"next/navigation\";\r\nimport { supabase } from \"../../../lib/supabaseClient\";\r\nimport BudgetUploadPage from \"../expenses/components/budgetUpload\";\r\nimport { categorizeExpense } from \"../dashboard/components/expensePieChart\";\r\nimport BudgetSummaryCards from \"./components/BudgetSummaryCards\";\r\nimport IncomeComparisonChart from \"./components/IncomeComparisonChart\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\n/* =========================\r\n   CATEGORY NORMALIZER\r\n========================= */\r\nfunction normalizeCategory(cat = \"\") {\r\n  const t = cat.toLowerCase();\r\n\r\n  if (\r\n      t.includes(\"personal\")||\r\n      t.includes(\"mPS\")\r\n)\r\n    { return \"Personal Services\";\r\n    }\r\n  // ‚úÖ FIX MOOE\r\n  if (\r\n    t.includes(\"mooe\") ||\r\n    t.includes(\"maintenance\") ||\r\n    t.includes(\"operating\")\r\n  ) {\r\n    return \"MOOE\";\r\n  }\r\n\r\n  // ‚úÖ FIX SK\r\n  if (\r\n    t.includes(\"sk\") ||\r\n    t.includes(\"sangguniang kabataan\") ||\r\n    t.includes(\"kabataan\")\r\n  ) {\r\n    return \"10% SK Fund\";\r\n  }\r\n\r\n  if (t.includes(\"20\") || t.includes(\"bdf\")) return \"20% BDF\";\r\n  if (t.includes(\"gadr\") || t.includes(\"gad\")) return \"15% GAD\";\r\n  if (t.includes(\"bdr\")) return \"5% BDRRMF\";\r\n  if (t.includes(\"senior\")) return \"1% Senior & PWD\";\r\n\r\n  return cat.trim();\r\n}\r\n/* =========================\r\n   INCOME CATEGORIZER\r\n========================= */\r\nfunction categorizeIncome(description = \"\") {\r\n  const t = description.toLowerCase();\r\n\r\n  if (t.includes(\"rpt\")) return \"RPT Share\";\r\n  if (t.includes(\"ctc\")) return \"CTC\";\r\n  if (t.includes(\"nta\") || t.includes(\"ira\")) return \"NTA\";\r\n  if (t.includes(\"subsidy\")) return \"Subsidy from LGM\";\r\n  if (t.includes(\"clearance\") || t.includes(\"certification\"))\r\n    return \"Certifications / Clearances\";\r\n  if (t.includes(\"rent\")) return \"Rent Income\";\r\n  if (t.includes(\"interest\")) return \"Interest Income\";\r\n  if (t.includes(\"water\")) return \"Brgy. Water System Income\";\r\n  if (t.includes(\"business\")) return \"Other Business Income\";\r\n\r\n  return \"Other Income\";\r\n}\r\n\r\n\r\nexport default function ExpensesPage() {\r\n  /* =========================\r\n     YEAR\r\n  ========================= */\r\n const searchParams = useSearchParams();\r\nconst yearParam = searchParams.get(\"year\");\r\nconst selectedYear = yearParam ? Number(yearParam) : null;\r\nconst [editOpen, setEditOpen] = useState(false);\r\nconst [deleteLoading, setDeleteLoading] = useState(false);\r\nconst [totalBudget, setTotalBudget] = useState(\"\");\r\nconst [isBudgetSaved, setIsBudgetSaved] = useState(false);\r\nconst router = useRouter();\r\n\r\n  /* =========================\r\n     UI STATE (UNCHANGED)\r\n  ========================= */\r\n  const [showUploadModal, setShowUploadModal] = useState(false);\r\n  const [showManualModal, setShowManualModal] = useState(false);\r\n  const [expandedCategory, setExpandedCategory] = useState(null);\r\n  const [refreshKey, setRefreshKey] = useState(0);\r\nconst [selectedSubcategory, setSelectedSubcategory] = useState(null);\r\nconst [editAmount, setEditAmount] = useState(\"\");\r\nconst [selectedCategory, setSelectedCategory] = useState(null);\r\n\r\n  /* =========================\r\n     DATA STATE\r\n  ========================= */\r\n  const [budgetRows, setBudgetRows] = useState([]);\r\n  const [transactions, setTransactions] = useState([]);\r\n\r\n  /* =========================\r\n     FETCH BUDGETS\r\n  ========================= */\r\n  const fetchBudgets = async () => {\r\n  const { data, error } = await supabase\r\n    .from(\"budget_uploads\")\r\n    .select(\"id, year, category, description, amount\")\r\n    .eq(\"year\", selectedYear);\r\n\r\n  if (error) {\r\n    console.error(error);\r\n    return;\r\n  }\r\n\r\n  setBudgetRows(data || []);\r\n};\r\n\r\n\r\n  /* =========================\r\n     FETCH TRANSACTIONS\r\n  ========================= */\r\n  const fetchTransactions = async () => {\r\n  const start = `${selectedYear}-01-01`;\r\n  const end = `${selectedYear}-12-31`;\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"transactions\")\r\n    .select(\"id, description, withdrawal, date\")\r\n    .gte(\"date\", start)\r\n    .lte(\"date\", end);\r\n\r\n  if (error) {\r\n    console.error(\"Transaction fetch error:\", error.message);\r\n    return;\r\n  }\r\n\r\n  setTransactions(data || []);\r\n};\r\n\r\n  /* =========================\r\n     INITIAL LOAD\r\n  ========================= */\r\nuseEffect(() => {\r\n  if (!selectedYear) return; // ‚õî do NOT fetch yet\r\n\r\n  fetchBudgets();\r\n  fetchTransactions();\r\n  fetchTotalBudget();\r\n}, [selectedYear, refreshKey]);\r\n\r\nuseEffect(() => {\r\n  if (!searchParams.get(\"year\")) {\r\n    const currentYear = new Date().getFullYear();\r\n    router.replace(`/expenses?year=${currentYear}`);\r\n  }\r\n}, [searchParams, router]);\r\n\r\n  /* =========================\r\n     GROUP BUDGETS\r\n  ========================= */\r\nconst groupedBudgets = useMemo(() => {\r\n  const map = {};\r\n\r\n  budgetRows.forEach((r) => {\r\n    const cat = normalizeCategory(r.category);\r\n\r\n    if (!map[cat]) {\r\n      map[cat] = {\r\n        category: cat,\r\n        allocated: 0,\r\n        items: [],\r\n      };\r\n    }\r\n\r\n    map[cat].allocated += Number(r.amount) || 0;\r\n    map[cat].items.push(r);\r\n  });\r\n\r\n  return Object.values(map).sort(\r\n    (a, b) => b.allocated - a.allocated\r\n  );\r\n}, [budgetRows]);\r\n\r\nconst normalize = (text = \"\") =>\r\n  text.toLowerCase().replace(/[^a-z0-9]/g, \"\");\r\n\r\nconst expensesBySubcategory = useMemo(() => {\r\n  const map = {};\r\n\r\n  transactions.forEach((t) => {\r\n    if (!t.withdrawal || t.withdrawal <= 0) return;\r\n\r\n    const tDesc = normalize(t.description);\r\n\r\n    budgetRows.forEach((b) => {\r\n      const bDesc = normalize(b.description);\r\n\r\n      // ‚úÖ MATCH BOTH DIRECTIONS\r\n      if (tDesc.includes(bDesc) || bDesc.includes(tDesc)) {\r\n        map[b.description] =\r\n          (map[b.description] || 0) + Number(t.withdrawal);\r\n      }\r\n    });\r\n  });\r\n\r\n  return map;\r\n}, [transactions, budgetRows]);\r\n\r\n\r\nuseEffect(() => {\r\n  console.log(\"Grouped Budgets:\", groupedBudgets.map(g => g.category));\r\n}, [groupedBudgets]);\r\n\r\n/* =========================\r\n   GROUP EXPENSES (CATEGORY)\r\n========================= */\r\nconst expensesByCategory = useMemo(() => {\r\n  const map = {};\r\n\r\n  transactions.forEach((t) => {\r\n    if (!t.withdrawal || t.withdrawal <= 0) return;\r\n\r\n    const raw = categorizeExpense(t.description || \"\");\r\n    if (!raw) return;\r\n\r\n    const cat = normalizeCategory(raw);\r\n\r\n    map[cat] = (map[cat] || 0) + Number(t.withdrawal);\r\n  });\r\n\r\n  return map;\r\n}, [transactions]);\r\n\r\n/* =========================\r\n   ACTUAL INCOME (FROM TRANSACTIONS)\r\n========================= */\r\nconst actualIncomeByCategory = useMemo(() => {\r\n  const map = {};\r\n\r\n  transactions.forEach((t) => {\r\n    if (!t.deposit || t.deposit <= 0) return;\r\n\r\n    const cat = categorizeIncome(t.description || \"\");\r\n    map[cat] = (map[cat] || 0) + Number(t.deposit);\r\n  });\r\n\r\n  return map;\r\n}, [transactions]);\r\n\r\n\r\n/* =========================\r\n   COMPARISON DATA (FOR CHART)\r\n========================= */\r\nconst comparisonData = useMemo(() => {\r\n  return groupedBudgets.map((b) => ({\r\n    category: b.category,\r\n    allocated: b.allocated,\r\n    spent: expensesByCategory[b.category] || 0,\r\n  }));\r\n}, [groupedBudgets, expensesByCategory]);\r\n\r\nconst handleEdit = (category, currentAmount) => {\r\n  setSelectedCategory(category);\r\n  setEditAmount(currentAmount); // üëà preload value\r\n  setEditOpen(true);\r\n};\r\n\r\nconst updateBudget = async () => {\r\n  if (!editAmount || Number(editAmount) <= 0) {\r\n    alert(\"Enter a valid amount\");\r\n    return;\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from(\"budget_uploads\")\r\n    .update({ amount: Number(editAmount) })\r\n    .eq(\"category\", selectedCategory);\r\n\r\n  if (error) {\r\n    console.error(error);\r\n    alert(\"Failed to update budget\");\r\n    return;\r\n  }\r\n\r\n  setEditOpen(false);\r\n  setEditAmount(\"\");\r\n  setSelectedCategory(null);\r\n  fetchBudgets(); // refresh list\r\n};\r\n/* =========================\r\n   INCOME COMPARISON DATA\r\n========================= */\r\nconst incomeComparisonData = useMemo(() => {\r\n  return Object.entries(actualIncomeByCategory).map(\r\n    ([category, actual]) => ({\r\n      category,\r\n      approved: Number(totalBudget) || 0,\r\n      actual,\r\n      balance: (Number(totalBudget) || 0) - actual,\r\n    })\r\n  );\r\n}, [actualIncomeByCategory, totalBudget]);\r\n\r\n\r\nconst handleDelete = (category, allocated, spent) => {\r\n  if (spent > allocated) {\r\n    alert(\"Cannot delete: budget already used.\");\r\n    return;\r\n  }\r\n\r\n  if (!confirm(`Delete all budget items under \"${category}\"?`)) return;\r\n\r\n  deleteCategory(category);\r\n};\r\n\r\n\r\nconst deleteCategory = async (category) => {\r\n  setDeleteLoading(true);\r\n\r\n  const { error } = await supabase\r\n    .from(\"budget_uploads\")\r\n    .delete()\r\n    .eq(\"category\", category);\r\n\r\n  setDeleteLoading(false);\r\n\r\n  if (error) {\r\n    console.error(error);\r\n    alert(\"Delete failed\");\r\n    return;\r\n  }\r\n\r\n  fetchBudgets();\r\n};\r\nconst saveTotalBudget = async () => {\r\n  if (!totalBudget || Number(totalBudget) <= 0) {\r\n    alert(\"Please enter a valid total budget\");\r\n    return;\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from(\"yearly_budget\")\r\n    .upsert(\r\n      {\r\n        year: selectedYear,        // e.g. 2026\r\n        total_income: Number(totalBudget),\r\n      },\r\n      { onConflict: \"year\" }\r\n    );\r\n\r\n  if (error) {\r\n    console.error(\"Save failed:\", error);\r\n    alert(\"Failed to save total budget\");\r\n    return;\r\n  }\r\n\r\n  // üîí LOCK AFTER SAVE\r\n  setIsBudgetSaved(true);\r\n  alert(\"Total budget saved successfully\");\r\n};\r\n\r\n\r\nconst fetchTotalBudget = async () => {\r\n  const { data, error } = await supabase\r\n    .from(\"yearly_budget\")\r\n    .select(\"total_income\")\r\n    .eq(\"year\", selectedYear)\r\n    .maybeSingle(); // ‚úÖ important\r\n\r\n  if (data?.total_income) {\r\n    // ‚úÖ Record exists ‚Üí lock\r\n    setTotalBudget(data.total_income);\r\n    setIsBudgetSaved(true);\r\n  } else {\r\n    // ‚úÖ No record ‚Üí unlock\r\n    setTotalBudget(\"\");\r\n    setIsBudgetSaved(false);\r\n  }\r\n};\r\n\r\n\r\n\r\n/* =========================\r\n     UI\r\n  ========================= */\r\nreturn (\r\n  <div className=\"min-h-screen bg-slate-50\">\r\n    {/* HEADER SECTION */}\r\n    <header className=\"rounded-2xl bg-gradient-to-r from-emerald-700 to-emerald-800 px-8 py-6 text-white shadow-xl\">\r\n      \r\n      {/* TOP SECTION: Logo/Title + Action Buttons */}\r\n      <div className=\"mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\r\n        \r\n        {/* Branding Section */}\r\n        <div className=\"flex items-center gap-4\">\r\n          <div className=\"rounded-xl bg-white/15 p-3 backdrop-blur-sm border border-white/20\">\r\n            <span className=\"text-2xl\">üìä</span>\r\n          </div>\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold tracking-tight\">Budget Allocation</h1>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"flex flex-wrap gap-3\">\r\n          <button\r\n            onClick={() => setShowUploadModal(true)}\r\n            className=\"flex items-center gap-2 rounded-lg bg-white/10 hover:bg-white/20 border border-white/20 \r\n                       px-5 py-2.5 font-medium text-white transition-all duration-200 \r\n                       hover:scale-[1.02] active:scale-[0.98] backdrop-blur-sm\"\r\n          >\r\n            <span className=\"text-lg\">üì§</span>\r\n            <span>Upload Budget File</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => setShowManualModal(true)}\r\n            className=\"flex items-center gap-2 rounded-lg bg-white px-5 py-2.5 font-semibold \r\n                       text-emerald-700 transition-all duration-200 hover:bg-slate-50 \r\n                       hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]\"\r\n          >\r\n            <span className=\"text-lg\">‚ûï</span>\r\n            <span>Add Budget Item</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* TOTAL BUDGET CONTROL PANEL */}\r\n      <div className=\"rounded-xl bg-white/15 backdrop-blur-sm border border-white/20 p-2\">\r\n        <div className=\"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4\">\r\n          \r\n          {/* Label and Info */}\r\n          <div className=\"space-y-1\">\r\n            <h2 className=\"text-sm font-semibold uppercase tracking-wider text-emerald-100\">\r\n              Total Annual Budget\r\n            </h2>\r\n            \r\n          </div>\r\n\r\n          {/* Input and Action */}\r\n          <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full lg:w-auto\">\r\n            <div className=\"relative flex-grow\">\r\n              <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500\"></span>\r\n              <input\r\n                type=\"number\"\r\n                placeholder=\"Enter total budget amount\"\r\n                value={totalBudget}\r\n                onChange={(e) => setTotalBudget(e.target.value)}\r\n                  disabled={isBudgetSaved}\r\n\r\nclassName={`w-full sm:w-64 rounded-lg px-4 py-2 text-sm border text-slate-900\r\n    ${isBudgetSaved\r\n      ? \"bg-slate-100 cursor-not-allowed text-slate-500\"\r\n      : \"bg-white focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20\"\r\n    }`}\r\n/>\r\n            </div>\r\n            \r\n            {!isBudgetSaved && (\r\n  <button\r\n    onClick={saveTotalBudget}\r\n    className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white\"\r\n  >\r\n    Save\r\n  </button>\r\n         )}\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n\r\n    </header>\r\n\r\n{showUploadModal && (\r\n  <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm\">\r\n    <div className=\"mx-4 w-full max-w-lg rounded-2xl bg-white shadow-2xl\r\n                    max-h-[85vh] flex flex-col\">\r\n\r\n      {/* HEADER */}\r\n      <div className=\"flex items-center justify-between border-b p-6\">\r\n        <div>\r\n          <h2 className=\"text-xl font-bold text-slate-800\">\r\n            Upload Budget File\r\n          </h2>\r\n          <p className=\"text-sm text-slate-500\">\r\n            Upload CSV or Excel files for bulk import\r\n          </p>\r\n        </div>\r\n        <button\r\n          onClick={() => setShowUploadModal(false)}\r\n          className=\"rounded-lg p-2 text-slate-400 hover:bg-slate-100 hover:text-slate-600\"\r\n        >\r\n          ‚úï\r\n        </button>\r\n      </div>\r\n\r\n      {/* BODY (SCROLLABLE) */}\r\n      <div className=\"p-6 overflow-y-auto\">\r\n        <BudgetUploadPage\r\n          mode=\"picker\"\r\n          selectedYear={selectedYear}\r\n          onSuccess={() => {\r\n            fetchBudgets();\r\n            setRefreshKey((k) => k + 1);\r\n            setShowUploadModal(false);\r\n          }}\r\n        />\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n)}\r\n\r\n\r\n      {showManualModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm\">\r\n          <div className=\"mx-4 w-full max-w-4xl rounded-2xl bg-white shadow-2xl\">\r\n            <div className=\"flex items-center justify-between border-b p-6\">\r\n              <div>\r\n                <h2 className=\"text-xl font-bold text-slate-800\">Add Budget Entry</h2>\r\n                <p className=\"text-sm text-slate-500\">Manually add a new budget allocation</p>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowManualModal(false)}\r\n                className=\"rounded-lg p-2 text-slate-400 hover:bg-slate-100 hover:text-slate-600\"\r\n              >\r\n                <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <BudgetUploadPage\r\n                mode=\"form\"\r\n                selectedYear={selectedYear}\r\n                onSuccess={() => {\r\n                  fetchBudgets();\r\n                  setRefreshKey((k) => k + 1);\r\n                  setShowManualModal(false);\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n{editOpen && (\r\n  <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60\">\r\n    <div className=\"w-full max-w-md rounded-xl bg-white p-6\">\r\n      <h2 className=\"text-lg font-semibold mb-4\">\r\n        Edit Budget ‚Äì {selectedCategory}\r\n      </h2>\r\n\r\n      <input\r\n        type=\"number\"\r\n        className=\"w-full rounded-lg border p-2 mb-4\"\r\n        placeholder=\"New Allocated Amount\"\r\n        value={editAmount}\r\n        onChange={(e) => setEditAmount(e.target.value)}\r\n      />\r\n\r\n      <div className=\"flex justify-end gap-3\">\r\n        <button\r\n          onClick={() => setEditOpen(false)}\r\n          className=\"px-4 py-2 rounded-lg border\"\r\n        >\r\n          Cancel\r\n        </button>\r\n\r\n        <button\r\n          onClick={updateBudget}\r\n          className=\"px-4 py-2 rounded-lg bg-emerald-600 text-white\"\r\n        >\r\n          Save\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n)}\r\n\r\n      {/* CONTENT */}\r\n      <div className=\"mt-8\">\r\n        <div className=\"mb-6 flex items-center justify-between\">\r\n          <div>\r\n          </div>\r\n          <div className=\"text-sm text-slate-500\">\r\n            Showing {groupedBudgets.length} categories\r\n          </div>\r\n        </div>\r\n    \r\n{/*INCOME ‚Äì APPROVED vs ACTUAL \r\n<div className=\"mb-12 rounded-2xl bg-white p-8 shadow-md border\">\r\n  <div className=\"mb-6 flex items-center justify-between\">\r\n    <div>\r\n      <h2 className=\"text-xl font-bold text-slate-800\">\r\n        Income ‚Äì Approved vs Actual\r\n      </h2>\r\n      <p className=\"text-sm text-slate-500\">\r\n        Comparison of planned income vs actual collections\r\n      </p>\r\n    </div>\r\n  </div>\r\n\r\n  <div className=\"w-full h-[420px]\">\r\n    <IncomeComparisonChart data={incomeComparisonData} />\r\n  </div>\r\n</div>\r\n*/}\r\n\r\n\r\n        {/* BUDGET CARDS GRID */}\r\n        {groupedBudgets.length > 0 ? (\r\n  <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 items-start\">\r\n    {groupedBudgets.map((g) => {\r\n      const isOpen = expandedCategory === g.category;\r\n\r\n      // ‚úÖ DEFINE spent HERE (THIS FIXES THE ERROR)\r\n      const spent = expensesByCategory[g.category] || 0;\r\n\r\n      return (\r\n        <BudgetSummaryCards\r\n          key={g.category}\r\n          category={g.category}\r\n          allocated={g.allocated}\r\n          spent={spent}\r\n          expensesByCategory={expensesByCategory}\r\n          spentBySubcategory={expensesBySubcategory}\r\n\r\n          // ‚úÖ USE g.category (NOT category)\r\n          onEdit={() => handleEdit(g.category)}\r\n          onDelete={() => handleDelete(g.category, g.allocated, spent)}\r\n\r\n          onSubcategoryClick={setSelectedSubcategory}\r\n          isOpen={isOpen}\r\n          onToggle={() =>\r\n            setExpandedCategory(isOpen ? null : g.category)\r\n          }\r\n          items={g.items}\r\n        />\r\n      );\r\n    })}\r\n  </div>\r\n\r\n        ) : (\r\n          <div className=\"rounded-2xl border-2 border-dashed border-slate-200 bg-white p-12 text-center\">\r\n            <div className=\"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-slate-100\">\r\n              <span className=\"text-2xl\">üìä</span>\r\n            </div>\r\n            <h3 className=\"mb-2 text-lg font-semibold text-slate-700\">No Budget Data</h3>\r\n            <p className=\"mb-6 text-slate-500\">Get started by uploading a file or adding a budget manually</p>\r\n            <div className=\"flex justify-center gap-3\">\r\n              <button\r\n                onClick={() => setShowUploadModal(true)}\r\n                className=\"rounded-lg bg-emerald-50 px-4 py-2 text-sm font-medium text-emerald-700 hover:bg-emerald-100\"\r\n              >\r\n                Upload File\r\n              </button>\r\n              <button\r\n                onClick={() => setShowManualModal(true)}\r\n                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white hover:bg-emerald-700\"\r\n              >\r\n                Add Budget\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        \r\n            \r\n        \r\n    \r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AATA;;;;;;;;;;AAYA;;0BAE0B,GAC1B,SAAS,kBAAkB,MAAM,EAAE;IACjC,MAAM,IAAI,IAAI,WAAW;IAEzB,IACI,EAAE,QAAQ,CAAC,eACX,EAAE,QAAQ,CAAC,QAEb;QAAE,OAAO;IACT;IACF,aAAa;IACb,IACE,EAAE,QAAQ,CAAC,WACX,EAAE,QAAQ,CAAC,kBACX,EAAE,QAAQ,CAAC,cACX;QACA,OAAO;IACT;IAEA,WAAW;IACX,IACE,EAAE,QAAQ,CAAC,SACX,EAAE,QAAQ,CAAC,2BACX,EAAE,QAAQ,CAAC,aACX;QACA,OAAO;IACT;IAEA,IAAI,EAAE,QAAQ,CAAC,SAAS,EAAE,QAAQ,CAAC,QAAQ,OAAO;IAClD,IAAI,EAAE,QAAQ,CAAC,WAAW,EAAE,QAAQ,CAAC,QAAQ,OAAO;IACpD,IAAI,EAAE,QAAQ,CAAC,QAAQ,OAAO;IAC9B,IAAI,EAAE,QAAQ,CAAC,WAAW,OAAO;IAEjC,OAAO,IAAI,IAAI;AACjB;AACA;;0BAE0B,GAC1B,SAAS,iBAAiB,cAAc,EAAE;IACxC,MAAM,IAAI,YAAY,WAAW;IAEjC,IAAI,EAAE,QAAQ,CAAC,QAAQ,OAAO;IAC9B,IAAI,EAAE,QAAQ,CAAC,QAAQ,OAAO;IAC9B,IAAI,EAAE,QAAQ,CAAC,UAAU,EAAE,QAAQ,CAAC,QAAQ,OAAO;IACnD,IAAI,EAAE,QAAQ,CAAC,YAAY,OAAO;IAClC,IAAI,EAAE,QAAQ,CAAC,gBAAgB,EAAE,QAAQ,CAAC,kBACxC,OAAO;IACT,IAAI,EAAE,QAAQ,CAAC,SAAS,OAAO;IAC/B,IAAI,EAAE,QAAQ,CAAC,aAAa,OAAO;IACnC,IAAI,EAAE,QAAQ,CAAC,UAAU,OAAO;IAChC,IAAI,EAAE,QAAQ,CAAC,aAAa,OAAO;IAEnC,OAAO;AACT;AAGe,SAAS;IACtB;;4BAE0B,GAC3B,MAAM,eAAe,IAAA,+JAAe;IACrC,MAAM,YAAY,aAAa,GAAG,CAAC;IACnC,MAAM,eAAe,YAAY,OAAO,aAAa;IACrD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,2NAAQ,EAAC;IACzC,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,2NAAQ,EAAC;IACnD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,2NAAQ,EAAC;IAC/C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,2NAAQ,EAAC;IACnD,MAAM,SAAS,IAAA,yJAAS;IAEtB;;4BAE0B,GAC1B,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,2NAAQ,EAAC;IACvD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,2NAAQ,EAAC;IACvD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,2NAAQ,EAAC;IACzD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,2NAAQ,EAAC;IAC/C,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,IAAA,2NAAQ,EAAC;IAC/D,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,2NAAQ,EAAC;IAC7C,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,2NAAQ,EAAC;IAEvD;;4BAE0B,GAC1B,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,2NAAQ,EAAC,EAAE;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,2NAAQ,EAAC,EAAE;IAEnD;;4BAE0B,GAC1B,MAAM,eAAe;QACrB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,kBACL,MAAM,CAAC,2CACP,EAAE,CAAC,QAAQ;QAEd,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC;YACd;QACF;QAEA,cAAc,QAAQ,EAAE;IAC1B;IAGE;;4BAE0B,GAC1B,MAAM,oBAAoB;QAC1B,MAAM,QAAQ,GAAG,aAAa,MAAM,CAAC;QACrC,MAAM,MAAM,GAAG,aAAa,MAAM,CAAC;QAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,gBACL,MAAM,CAAC,qCACP,GAAG,CAAC,QAAQ,OACZ,GAAG,CAAC,QAAQ;QAEf,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,4BAA4B,MAAM,OAAO;YACvD;QACF;QAEA,gBAAgB,QAAQ,EAAE;IAC5B;IAEE;;4BAE0B,GAC5B,IAAA,4NAAS,EAAC;QACR,IAAI,CAAC,cAAc,QAAQ,qBAAqB;QAEhD;QACA;QACA;IACF,GAAG;QAAC;QAAc;KAAW;IAE7B,IAAA,4NAAS,EAAC;QACR,IAAI,CAAC,aAAa,GAAG,CAAC,SAAS;YAC7B,MAAM,cAAc,IAAI,OAAO,WAAW;YAC1C,OAAO,OAAO,CAAC,CAAC,eAAe,EAAE,aAAa;QAChD;IACF,GAAG;QAAC;QAAc;KAAO;IAEvB;;4BAE0B,GAC5B,MAAM,iBAAiB,IAAA,0NAAO,EAAC;QAC7B,MAAM,MAAM,CAAC;QAEb,WAAW,OAAO,CAAC,CAAC;YAClB,MAAM,MAAM,kBAAkB,EAAE,QAAQ;YAExC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE;gBACb,GAAG,CAAC,IAAI,GAAG;oBACT,UAAU;oBACV,WAAW;oBACX,OAAO,EAAE;gBACX;YACF;YAEA,GAAG,CAAC,IAAI,CAAC,SAAS,IAAI,OAAO,EAAE,MAAM,KAAK;YAC1C,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;QACtB;QAEA,OAAO,OAAO,MAAM,CAAC,KAAK,IAAI,CAC5B,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;IAEvC,GAAG;QAAC;KAAW;IAEf,MAAM,YAAY,CAAC,OAAO,EAAE,GAC1B,KAAK,WAAW,GAAG,OAAO,CAAC,cAAc;IAE3C,MAAM,wBAAwB,IAAA,0NAAO,EAAC;QACpC,MAAM,MAAM,CAAC;QAEb,aAAa,OAAO,CAAC,CAAC;YACpB,IAAI,CAAC,EAAE,UAAU,IAAI,EAAE,UAAU,IAAI,GAAG;YAExC,MAAM,QAAQ,UAAU,EAAE,WAAW;YAErC,WAAW,OAAO,CAAC,CAAC;gBAClB,MAAM,QAAQ,UAAU,EAAE,WAAW;gBAErC,0BAA0B;gBAC1B,IAAI,MAAM,QAAQ,CAAC,UAAU,MAAM,QAAQ,CAAC,QAAQ;oBAClD,GAAG,CAAC,EAAE,WAAW,CAAC,GAChB,CAAC,GAAG,CAAC,EAAE,WAAW,CAAC,IAAI,CAAC,IAAI,OAAO,EAAE,UAAU;gBACnD;YACF;QACF;QAEA,OAAO;IACT,GAAG;QAAC;QAAc;KAAW;IAG7B,IAAA,4NAAS,EAAC;QACR,QAAQ,GAAG,CAAC,oBAAoB,eAAe,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ;IACpE,GAAG;QAAC;KAAe;IAEnB;;0BAE0B,GAC1B,MAAM,qBAAqB,IAAA,0NAAO,EAAC;QACjC,MAAM,MAAM,CAAC;QAEb,aAAa,OAAO,CAAC,CAAC;YACpB,IAAI,CAAC,EAAE,UAAU,IAAI,EAAE,UAAU,IAAI,GAAG;YAExC,MAAM,MAAM,IAAA,kMAAiB,EAAC,EAAE,WAAW,IAAI;YAC/C,IAAI,CAAC,KAAK;YAEV,MAAM,MAAM,kBAAkB;YAE9B,GAAG,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,IAAI,OAAO,EAAE,UAAU;QAClD;QAEA,OAAO;IACT,GAAG;QAAC;KAAa;IAEjB;;0BAE0B,GAC1B,MAAM,yBAAyB,IAAA,0NAAO,EAAC;QACrC,MAAM,MAAM,CAAC;QAEb,aAAa,OAAO,CAAC,CAAC;YACpB,IAAI,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,IAAI,GAAG;YAElC,MAAM,MAAM,iBAAiB,EAAE,WAAW,IAAI;YAC9C,GAAG,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,IAAI,OAAO,EAAE,OAAO;QAC/C;QAEA,OAAO;IACT,GAAG;QAAC;KAAa;IAGjB;;0BAE0B,GAC1B,MAAM,iBAAiB,IAAA,0NAAO,EAAC;QAC7B,OAAO,eAAe,GAAG,CAAC,CAAC,IAAM,CAAC;gBAChC,UAAU,EAAE,QAAQ;gBACpB,WAAW,EAAE,SAAS;gBACtB,OAAO,kBAAkB,CAAC,EAAE,QAAQ,CAAC,IAAI;YAC3C,CAAC;IACH,GAAG;QAAC;QAAgB;KAAmB;IAEvC,MAAM,aAAa,CAAC,UAAU;QAC5B,oBAAoB;QACpB,cAAc,gBAAgB,mBAAmB;QACjD,YAAY;IACd;IAEA,MAAM,eAAe;QACnB,IAAI,CAAC,cAAc,OAAO,eAAe,GAAG;YAC1C,MAAM;YACN;QACF;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CAC7B,IAAI,CAAC,kBACL,MAAM,CAAC;YAAE,QAAQ,OAAO;QAAY,GACpC,EAAE,CAAC,YAAY;QAElB,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC;YACd,MAAM;YACN;QACF;QAEA,YAAY;QACZ,cAAc;QACd,oBAAoB;QACpB,gBAAgB,eAAe;IACjC;IACA;;0BAE0B,GAC1B,MAAM,uBAAuB,IAAA,0NAAO,EAAC;QACnC,OAAO,OAAO,OAAO,CAAC,wBAAwB,GAAG,CAC/C,CAAC,CAAC,UAAU,OAAO,GAAK,CAAC;gBACvB;gBACA,UAAU,OAAO,gBAAgB;gBACjC;gBACA,SAAS,CAAC,OAAO,gBAAgB,CAAC,IAAI;YACxC,CAAC;IAEL,GAAG;QAAC;QAAwB;KAAY;IAGxC,MAAM,eAAe,CAAC,UAAU,WAAW;QACzC,IAAI,QAAQ,WAAW;YACrB,MAAM;YACN;QACF;QAEA,IAAI,CAAC,QAAQ,CAAC,+BAA+B,EAAE,SAAS,EAAE,CAAC,GAAG;QAE9D,eAAe;IACjB;IAGA,MAAM,iBAAiB,OAAO;QAC5B,iBAAiB;QAEjB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CAC7B,IAAI,CAAC,kBACL,MAAM,GACN,EAAE,CAAC,YAAY;QAElB,iBAAiB;QAEjB,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC;YACd,MAAM;YACN;QACF;QAEA;IACF;IACA,MAAM,kBAAkB;QACtB,IAAI,CAAC,eAAe,OAAO,gBAAgB,GAAG;YAC5C,MAAM;YACN;QACF;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CAC7B,IAAI,CAAC,iBACL,MAAM,CACL;YACE,MAAM;YACN,cAAc,OAAO;QACvB,GACA;YAAE,YAAY;QAAO;QAGzB,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,gBAAgB;YAC9B,MAAM;YACN;QACF;QAEA,qBAAqB;QACrB,iBAAiB;QACjB,MAAM;IACR;IAGA,MAAM,mBAAmB;QACvB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CACnC,IAAI,CAAC,iBACL,MAAM,CAAC,gBACP,EAAE,CAAC,QAAQ,cACX,WAAW,IAAI,cAAc;QAEhC,IAAI,MAAM,cAAc;YACtB,yBAAyB;YACzB,eAAe,KAAK,YAAY;YAChC,iBAAiB;QACnB,OAAO;YACL,uBAAuB;YACvB,eAAe;YACf,iBAAiB;QACnB;IACF;IAIA;;4BAE4B,GAC5B,qBACE,wPAAC;QAAI,WAAU;;0BAEb,wPAAC;gBAAO,WAAU;;kCAGhB,wPAAC;wBAAI,WAAU;;0CAGb,wPAAC;gCAAI,WAAU;;kDACb,wPAAC;wCAAI,WAAU;kDACb,cAAA,wPAAC;4CAAK,WAAU;sDAAW;;;;;;;;;;;kDAE7B,wPAAC;kDACC,cAAA,wPAAC;4CAAG,WAAU;sDAAoC;;;;;;;;;;;;;;;;;0CAKtD,wPAAC;gCAAI,WAAU;;kDACb,wPAAC;wCACC,SAAS,IAAM,mBAAmB;wCAClC,WAAU;;0DAIV,wPAAC;gDAAK,WAAU;0DAAU;;;;;;0DAC1B,wPAAC;0DAAK;;;;;;;;;;;;kDAGR,wPAAC;wCACC,SAAS,IAAM,mBAAmB;wCAClC,WAAU;;0DAIV,wPAAC;gDAAK,WAAU;0DAAU;;;;;;0DAC1B,wPAAC;0DAAK;;;;;;;;;;;;;;;;;;;;;;;;kCAMZ,wPAAC;wBAAI,WAAU;kCACb,cAAA,wPAAC;4BAAI,WAAU;;8CAGb,wPAAC;oCAAI,WAAU;8CACb,cAAA,wPAAC;wCAAG,WAAU;kDAAkE;;;;;;;;;;;8CAOlF,wPAAC;oCAAI,WAAU;;sDACb,wPAAC;4CAAI,WAAU;;8DACb,wPAAC;oDAAK,WAAU;;;;;;8DAChB,wPAAC;oDACC,MAAK;oDACL,aAAY;oDACZ,OAAO;oDACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;oDAC5C,UAAU;oDAE5B,WAAW,CAAC;IACR,EAAE,gBACE,mDACA,4EACF;;;;;;;;;;;;wCAIO,CAAC,+BACZ,wPAAC;4CACC,SAAS;4CACT,WAAU;sDACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAWF,iCACC,wPAAC;gBAAI,WAAU;0BACb,cAAA,wPAAC;oBAAI,WAAU;;sCAIb,wPAAC;4BAAI,WAAU;;8CACb,wPAAC;;sDACC,wPAAC;4CAAG,WAAU;sDAAmC;;;;;;sDAGjD,wPAAC;4CAAE,WAAU;sDAAyB;;;;;;;;;;;;8CAIxC,wPAAC;oCACC,SAAS,IAAM,mBAAmB;oCAClC,WAAU;8CACX;;;;;;;;;;;;sCAMH,wPAAC;4BAAI,WAAU;sCACb,cAAA,wPAAC,oLAAgB;gCACf,MAAK;gCACL,cAAc;gCACd,WAAW;oCACT;oCACA,cAAc,CAAC,IAAM,IAAI;oCACzB,mBAAmB;gCACrB;;;;;;;;;;;;;;;;;;;;;;YASH,iCACC,wPAAC;gBAAI,WAAU;0BACb,cAAA,wPAAC;oBAAI,WAAU;;sCACb,wPAAC;4BAAI,WAAU;;8CACb,wPAAC;;sDACC,wPAAC;4CAAG,WAAU;sDAAmC;;;;;;sDACjD,wPAAC;4CAAE,WAAU;sDAAyB;;;;;;;;;;;;8CAExC,wPAAC;oCACC,SAAS,IAAM,mBAAmB;oCAClC,WAAU;8CAEV,cAAA,wPAAC;wCAAI,WAAU;wCAAU,MAAK;wCAAO,QAAO;wCAAe,SAAQ;kDACjE,cAAA,wPAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;sCAI3E,wPAAC;4BAAI,WAAU;sCACb,cAAA,wPAAC,oLAAgB;gCACf,MAAK;gCACL,cAAc;gCACd,WAAW;oCACT;oCACA,cAAc,CAAC,IAAM,IAAI;oCACzB,mBAAmB;gCACrB;;;;;;;;;;;;;;;;;;;;;;YAMf,0BACC,wPAAC;gBAAI,WAAU;0BACb,cAAA,wPAAC;oBAAI,WAAU;;sCACb,wPAAC;4BAAG,WAAU;;gCAA6B;gCAC1B;;;;;;;sCAGjB,wPAAC;4BACC,MAAK;4BACL,WAAU;4BACV,aAAY;4BACZ,OAAO;4BACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;;;;;;sCAG/C,wPAAC;4BAAI,WAAU;;8CACb,wPAAC;oCACC,SAAS,IAAM,YAAY;oCAC3B,WAAU;8CACX;;;;;;8CAID,wPAAC;oCACC,SAAS;oCACT,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;0BASH,wPAAC;gBAAI,WAAU;;kCACb,wPAAC;wBAAI,WAAU;;0CACb,wPAAC;;;;;0CAED,wPAAC;gCAAI,WAAU;;oCAAyB;oCAC7B,eAAe,MAAM;oCAAC;;;;;;;;;;;;;oBAyBlC,eAAe,MAAM,GAAG,kBAC/B,wPAAC;wBAAI,WAAU;kCACZ,eAAe,GAAG,CAAC,CAAC;4BACnB,MAAM,SAAS,qBAAqB,EAAE,QAAQ;4BAE9C,6CAA6C;4BAC7C,MAAM,QAAQ,kBAAkB,CAAC,EAAE,QAAQ,CAAC,IAAI;4BAEhD,qBACE,wPAAC,0LAAkB;gCAEjB,UAAU,EAAE,QAAQ;gCACpB,WAAW,EAAE,SAAS;gCACtB,OAAO;gCACP,oBAAoB;gCACpB,oBAAoB;gCAEpB,kCAAkC;gCAClC,QAAQ,IAAM,WAAW,EAAE,QAAQ;gCACnC,UAAU,IAAM,aAAa,EAAE,QAAQ,EAAE,EAAE,SAAS,EAAE;gCAEtD,oBAAoB;gCACpB,QAAQ;gCACR,UAAU,IACR,oBAAoB,SAAS,OAAO,EAAE,QAAQ;gCAEhD,OAAO,EAAE,KAAK;+BAhBT,EAAE,QAAQ;;;;;wBAmBrB;;;;;6CAIM,wPAAC;wBAAI,WAAU;;0CACb,wPAAC;gCAAI,WAAU;0CACb,cAAA,wPAAC;oCAAK,WAAU;8CAAW;;;;;;;;;;;0CAE7B,wPAAC;gCAAG,WAAU;0CAA4C;;;;;;0CAC1D,wPAAC;gCAAE,WAAU;0CAAsB;;;;;;0CACnC,wPAAC;gCAAI,WAAU;;kDACb,wPAAC;wCACC,SAAS,IAAM,mBAAmB;wCAClC,WAAU;kDACX;;;;;;kDAGD,wPAAC;wCACC,SAAS,IAAM,mBAAmB;wCAClC,WAAU;kDACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcf","debugId":null}}]
}