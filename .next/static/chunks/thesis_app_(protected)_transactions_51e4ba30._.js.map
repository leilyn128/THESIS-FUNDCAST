{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/lib/useBudgetData.js"],"sourcesContent":["\"use client\"\r\nimport { useState } from \"react\"\r\nimport { supabase } from \"../../../../lib/supabaseClient\"\r\n\r\nexport default function useBudgetData() {\r\n  const [budgetData, setBudgetData] = useState([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  async function fetchBudgetData() {\r\n    setLoading(true)\r\n\r\n    const { data, error } = await supabase\r\n      .from(\"yearly_budget\")\r\n      .select(\"year,total_income\")\r\n      .order(\"year\", { ascending: true })\r\n\r\n    setLoading(false)\r\n    if (error) return console.error(error)\r\n\r\n    setBudgetData(\r\n      data.map(d => ({\r\n        year: Number(d.year),\r\n        totalIncome: Number(d.total_income)\r\n      }))\r\n    )\r\n  }\r\n\r\n  return { budgetData, loading, fetchBudgetData }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;;AAFA;;;AAIe,SAAS;;IACtB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,mLAAQ,EAAC,EAAE;IAC/C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,mLAAQ,EAAC;IAEvC,eAAe;QACb,WAAW;QAEX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,8IAAQ,CACnC,IAAI,CAAC,iBACL,MAAM,CAAC,qBACP,KAAK,CAAC,QAAQ;YAAE,WAAW;QAAK;QAEnC,WAAW;QACX,IAAI,OAAO,OAAO,QAAQ,KAAK,CAAC;QAEhC,cACE,KAAK,GAAG,CAAC,CAAA,IAAK,CAAC;gBACb,MAAM,OAAO,EAAE,IAAI;gBACnB,aAAa,OAAO,EAAE,YAAY;YACpC,CAAC;IAEL;IAEA,OAAO;QAAE;QAAY;QAAS;IAAgB;AAChD;GAxBwB","debugId":null}},
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/lib/useBreakdownData.js"],"sourcesContent":["\"use client\"\r\nimport { useState } from \"react\"\r\nimport { supabase } from \"../../../../lib/supabaseClient\"\r\n\r\nexport default function useBreakdownData() {\r\n  const [breakdownData, setBreakdownData] = useState({})\r\n\r\n  async function fetchBreakdownData() {\r\n    const { data, error } = await supabase\r\n      .from(\"barangay_budget_breakdown\")\r\n      .select(\"year, category, subcategory, description, amount\")\r\n\r\n    if (error) return console.error(error)\r\n\r\n    const grouped = {}\r\n\r\n    data.forEach(row => {\r\n      const year = Number(row.year)\r\n      if (!grouped[year]) grouped[year] = { income: {}, appropriations: {} }\r\n\r\n      const cat = row.category?.toLowerCase().includes(\"income\")\r\n        ? \"income\"\r\n        : \"appropriations\"\r\n\r\n      const label = row.subcategory || row.description || \"Uncategorized\"\r\n      const value = Number(String(row.amount).replace(/[^\\d.-]/g, \"\"))\r\n\r\n      grouped[year][cat][label] =\r\n        (grouped[year][cat][label] || 0) + value\r\n    })\r\n\r\n    setBreakdownData(grouped)\r\n  }\r\n\r\n  return { breakdownData, fetchBreakdownData }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;;AAFA;;;AAIe,SAAS;;IACtB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,mLAAQ,EAAC,CAAC;IAEpD,eAAe;QACb,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,8IAAQ,CACnC,IAAI,CAAC,6BACL,MAAM,CAAC;QAEV,IAAI,OAAO,OAAO,QAAQ,KAAK,CAAC;QAEhC,MAAM,UAAU,CAAC;QAEjB,KAAK,OAAO,CAAC,CAAA;gBAIC;YAHZ,MAAM,OAAO,OAAO,IAAI,IAAI;YAC5B,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,GAAG;gBAAE,QAAQ,CAAC;gBAAG,gBAAgB,CAAC;YAAE;YAErE,MAAM,MAAM,EAAA,gBAAA,IAAI,QAAQ,cAAZ,oCAAA,cAAc,WAAW,GAAG,QAAQ,CAAC,aAC7C,WACA;YAEJ,MAAM,QAAQ,IAAI,WAAW,IAAI,IAAI,WAAW,IAAI;YACpD,MAAM,QAAQ,OAAO,OAAO,IAAI,MAAM,EAAE,OAAO,CAAC,YAAY;YAE5D,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,GACvB,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI;QACvC;QAEA,iBAAiB;IACnB;IAEA,OAAO;QAAE;QAAe;IAAmB;AAC7C;GA/BwB","debugId":null}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/components/budgetUploader.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport Papa from \"papaparse\"\r\nimport * as XLSX from \"xlsx\"\r\nimport { supabase } from \"../../../../lib/supabaseClient\"\r\nimport { useEffect, useState } from \"react\"\r\n\r\nexport default function BudgetUploader({ refresh }) {\r\n  const [uploading, setUploading] = useState(false)\r\n  const [adding, setAdding] = useState(false)\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const [budgets, setBudgets] = useState([])\r\n\r\n  const [year, setYear] = useState(\"\")\r\n  const [amount, setAmount] = useState(\"\")\r\n  const [forecastYears, setForecastYears] = useState(3) // default 5 years\r\n\r\n  // =============================\r\n  // LOAD EXISTING BUDGETS\r\n  // =============================\r\n  async function loadBudgets() {\r\n    const { data, error } = await supabase\r\n      .from(\"yearly_budget\")\r\n      .select(\"*\")\r\n      .order(\"year\", { ascending: true })\r\n\r\n    if (!error) setBudgets(data)\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadBudgets()\r\n  }, [])\r\n\r\n  // =============================\r\n  // DELETE ONE YEAR\r\n  // =============================\r\n  async function deleteBudget(y) {\r\n    if (!confirm(`Delete budget for year ${y}?`)) return\r\n\r\n    await supabase.from(\"yearly_budget\").delete().eq(\"year\", y)\r\n    loadBudgets()\r\n    refresh()\r\n  }\r\n\r\n  // =============================\r\n  // FILE UPLOAD\r\n  // =============================\r\n  async function handleFileUpload(event) {\r\n    const file = event.target.files[0]\r\n    if (!file) return\r\n    setUploading(true)\r\n\r\n    try {\r\n      let rows = []\r\n      const fileName = file.name.toLowerCase()\r\n\r\n      if (fileName.endsWith(\".csv\")) {\r\n        const text = await file.text()\r\n        rows = Papa.parse(text, { header: true }).data\r\n      } else {\r\n        const buffer = await file.arrayBuffer()\r\n        const sheet = XLSX.read(buffer).Sheets[\"Sheet1\"]\r\n        rows = XLSX.utils.sheet_to_json(sheet)\r\n      }\r\n\r\n      for (const row of rows) {\r\n        const year = Number(row.year)\r\n        const income = Number(String(row.total_income).replace(/[^\\d.-]/g, \"\"))\r\n        if (!year || !income) continue\r\n\r\n        await supabase.from(\"yearly_budget\").upsert({\r\n          year,\r\n          total_income: income\r\n        })\r\n      }\r\n\r\n      await loadBudgets()\r\n      refresh()\r\n      alert(\"Upload successful!\")\r\n    } catch (e) {\r\n      console.error(e)\r\n      alert(\"Upload error.\")\r\n    }\r\n\r\n    setUploading(false)\r\n  }\r\n\r\n  // =============================\r\n  // MANUAL ADD FORM\r\n  // =============================\r\n  async function handleAddBudget(e) {\r\n    e.preventDefault()\r\n    if (!year || !amount) {\r\n      alert(\"Please fill out both fields.\")\r\n      return\r\n    }\r\n\r\n    setAdding(true)\r\n\r\n    try {\r\n      await supabase.from(\"yearly_budget\").upsert({\r\n        year: Number(year),\r\n        total_income: Number(amount),\r\n      })\r\n\r\n      setYear(\"\")\r\n      setAmount(\"\")\r\n      await loadBudgets()\r\n      refresh()\r\n      alert(\"Budget added!\")\r\n    } catch (err) {\r\n      console.error(err)\r\n      alert(\"Error adding budget.\")\r\n    }\r\n\r\n    setAdding(false)\r\n  }\r\n\r\n  // =============================\r\n  // RENDER\r\n  // =============================\r\n  return (\r\n    <div className=\"mb-8 space-y-6\">\r\n\r\n      {/* ========== BUTTONS ========== */}\r\n      <div className=\"flex items-center gap-4\">\r\n        {/* UPLOAD BUTTON */}\r\n        <label className=\"inline-block bg-blue-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-blue-700\">\r\n          {uploading ? \"Uploading...\" : \"Upload CSV/Excel\"}\r\n          <input type=\"file\" className=\"hidden\" onChange={handleFileUpload} />\r\n        </label>\r\n\r\n        {/* ADD NEW BUDGET (COLLAPSE) */}\r\n        <button\r\n          onClick={() => setIsOpen(!isOpen)}\r\n          className=\"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700\"\r\n        >\r\n          {isOpen ? \"Hide Manual Entry\" : \"Add New Budget\"}\r\n        </button>\r\n\r\n        {/* FORECAST YEARS SELECTOR */}\r\n        <select\r\n          value={forecastYears}\r\n          onChange={(e) => setForecastYears(Number(e.target.value))}\r\n          className=\"border px-3 py-2 rounded-lg\"\r\n        >\r\n          <option value={3}>Forecast: 1 Year</option>\r\n          <option value={5}>Forecast: 2 Years</option>\r\n          <option value={3}>Forecast: 3 Years</option>\r\n          <option value={5}>Forecast: 4 Years</option>\r\n          <option value={5}>Forecast: 5 Years</option>\r\n\r\n         \r\n\r\n        </select>\r\n      </div>\r\n\r\n      {/* ========== COLLAPSIBLE MANUAL ENTRY ========== */}\r\n      <div\r\n        className={`overflow-hidden transition-all duration-300 ${\r\n          isOpen ? \"max-h-[500px] opacity-100\" : \"max-h-0 opacity-0\"\r\n        }`}\r\n      >\r\n        <form\r\n          onSubmit={handleAddBudget}\r\n          className=\"bg-white shadow p-4 rounded-lg space-y-3 max-w-md mt-3\"\r\n        >\r\n          <h3 className=\"text-lg font-semibold\">Add New Budget</h3>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium\">Year</label>\r\n            <input\r\n              type=\"number\"\r\n              min=\"2000\"\r\n              max=\"2100\"\r\n              value={year}\r\n              onChange={(e) => setYear(e.target.value)}\r\n              className=\"mt-1 block w-full border rounded-lg p-2\"\r\n              placeholder=\"Enter year (e.g., 2025)\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium\">Total Income</label>\r\n            <input\r\n              type=\"number\"\r\n              value={amount}\r\n              onChange={(e) => setAmount(e.target.value)}\r\n              className=\"mt-1 block w-full border rounded-lg p-2\"\r\n              placeholder=\"Enter amount (e.g., 2500000)\"\r\n            />\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            className=\"w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700\"\r\n          >\r\n            {adding ? \"Saving...\" : \"Add Budget\"}\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      {/* ========== TABLE OF BUDGETS (DELETE SUPPORT) ========== */}\r\n      <div className=\"bg-white shadow p-4 rounded-lg\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">Budgets</h3>\r\n\r\n        <table className=\"w-full text-sm\">\r\n          <thead>\r\n            <tr className=\"text-left border-b\">\r\n              <th className=\"py-2\">Year</th>\r\n              <th>Total Income</th>\r\n              <th></th>\r\n            </tr>\r\n          </thead>\r\n\r\n          <tbody>\r\n            {budgets.map((b) => (\r\n              <tr key={b.year} className=\"border-b\">\r\n                <td className=\"py-2\">{b.year}</td>\r\n                <td>₱{b.total_income.toLocaleString()}</td>\r\n                <td className=\"text-right\">\r\n                  <button\r\n                    onClick={() => deleteBudget(b.year)}\r\n                    className=\"text-red-600 hover:underline\"\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n\r\n            {budgets.length === 0 && (\r\n              <tr>\r\n                <td colSpan={3} className=\"py-3 text-center text-gray-500\">\r\n                  No data yet.\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 531, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/components/summaryCards.jsx"],"sourcesContent":["export default function SummaryCards({ data }) {\r\n  const total = data.reduce((s, d) => s + d.totalIncome, 0)\r\n  const avg = total / data.length\r\n  const max = Math.max(...data.map(d => d.totalIncome))\r\n  const min = Math.min(...data.map(d => d.totalIncome))\r\n\r\n  const currency = val =>\r\n    new Intl.NumberFormat(\"en-PH\", { style: \"currency\", currency: \"PHP\" }).format(val)\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n      <Card label=\"Total Income\" value={currency(total)} color=\"indigo\" />\r\n      <Card label=\"Average Income\" value={currency(avg)} color=\"green\" />\r\n      <Card label=\"Highest Income\" value={currency(max)} color=\"yellow\" />\r\n      <Card label=\"Lowest Income\" value={currency(min)} color=\"red\" />\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction Card({ label, value, color }) {\r\n  const colors = {\r\n    indigo: \"bg-indigo-50 text-indigo-700\",\r\n    green: \"bg-green-50 text-green-700\",\r\n    yellow: \"bg-yellow-50 text-yellow-700\",\r\n    red: \"bg-red-50 text-red-700\",\r\n  }\r\n\r\n  return (\r\n    <div className={`p-4 rounded-lg text-center ${colors[color]}`}>\r\n      <p className=\"text-sm text-gray-600\">{label}</p>\r\n      <p className=\"text-lg font-semibold\">{value}</p>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAe,SAAS,aAAa,KAAQ;QAAR,EAAE,IAAI,EAAE,GAAR;IACnC,MAAM,QAAQ,KAAK,MAAM,CAAC,CAAC,GAAG,IAAM,IAAI,EAAE,WAAW,EAAE;IACvD,MAAM,MAAM,QAAQ,KAAK,MAAM;IAC/B,MAAM,MAAM,KAAK,GAAG,IAAI,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW;IACnD,MAAM,MAAM,KAAK,GAAG,IAAI,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW;IAEnD,MAAM,WAAW,CAAA,MACf,IAAI,KAAK,YAAY,CAAC,SAAS;YAAE,OAAO;YAAY,UAAU;QAAM,GAAG,MAAM,CAAC;IAEhF,qBACE,uMAAC;QAAI,WAAU;;0BACb,uMAAC;gBAAK,OAAM;gBAAe,OAAO,SAAS;gBAAQ,OAAM;;;;;;0BACzD,uMAAC;gBAAK,OAAM;gBAAiB,OAAO,SAAS;gBAAM,OAAM;;;;;;0BACzD,uMAAC;gBAAK,OAAM;gBAAiB,OAAO,SAAS;gBAAM,OAAM;;;;;;0BACzD,uMAAC;gBAAK,OAAM;gBAAgB,OAAO,SAAS;gBAAM,OAAM;;;;;;;;;;;;AAG9D;KAjBwB;AAmBxB,SAAS,KAAK,KAAuB;QAAvB,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAvB;IACZ,MAAM,SAAS;QACb,QAAQ;QACR,OAAO;QACP,QAAQ;QACR,KAAK;IACP;IAEA,qBACE,uMAAC;QAAI,WAAW,AAAC,8BAA2C,OAAd,MAAM,CAAC,MAAM;;0BACzD,uMAAC;gBAAE,WAAU;0BAAyB;;;;;;0BACtC,uMAAC;gBAAE,WAAU;0BAAyB;;;;;;;;;;;;AAG5C;MAdS","debugId":null}},
    {"offset": {"line": 639, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/components/breakdownPieSection.jsx"],"sourcesContent":["\"use client\"\r\nimport { PieChart, Pie, Cell, Tooltip, ResponsiveContainer } from \"recharts\"\r\n\r\nexport default function BreakdownPieSection({ selectedYear, breakdown }) {\r\n  const COLORS = [\"#4F46E5\", \"#10B981\", \"#F59E0B\", \"#EF4444\", \"#3B82F6\"]\r\n\r\n  if (!selectedYear)\r\n    return <p className=\"text-gray-500 text-center\">Click a year to view breakdown</p>\r\n\r\n  return (\r\n    <div className=\"bg-white shadow rounded-lg p-4 mt-6\">\r\n      <h3 className=\"text-lg font-semibold mb-2\">\r\n        Budget Breakdown ({selectedYear})\r\n      </h3>\r\n\r\n      <div className=\"flex flex-col lg:flex-row gap-8 justify-center mt-6\">\r\n        <PieGroup title=\"Income Breakdown\" data={breakdown.income || {}} colors={COLORS} />\r\n        <PieGroup title=\"Appropriations Breakdown\" data={breakdown.appropriations || {}} colors={COLORS} />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction PieGroup({ title, data, colors }) {\r\n  const formatted = Object.entries(data).map(([name, value]) => ({ name, value }))\r\n  const total = formatted.reduce((sum, i) => sum + i.value, 0)\r\n\r\n  // Convert value → percentage\r\n  const toPercent = (v) => ((v / total) * 100).toFixed(2) + \"%\"\r\n\r\n  return (\r\n    <div className=\"w-full lg:w-1/2\">\r\n      <p className=\"font-semibold text-center\">{title}</p>\r\n\r\n      <ResponsiveContainer width=\"100%\" height={360}>\r\n        <PieChart>\r\n          <Pie\r\n            data={formatted}\r\n            dataKey=\"value\"\r\n            nameKey=\"name\"\r\n            outerRadius={110}\r\n            label={({ name, value }) => `${name}: ${toPercent(value)}`}\r\n          >\r\n            {formatted.map((entry, index) => (\r\n              <Cell key={index} fill={colors[index % colors.length]} />\r\n            ))}\r\n          </Pie>\r\n\r\n          <Tooltip\r\n            formatter={(value) => toPercent(value)}\r\n            labelFormatter={(name) => name}\r\n          />\r\n        </PieChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AAAA;AAAA;AAAA;AAAA;AADA;;;AAGe,SAAS,oBAAoB,KAA2B;QAA3B,EAAE,YAAY,EAAE,SAAS,EAAE,GAA3B;IAC1C,MAAM,SAAS;QAAC;QAAW;QAAW;QAAW;QAAW;KAAU;IAEtE,IAAI,CAAC,cACH,qBAAO,uMAAC;QAAE,WAAU;kBAA4B;;;;;;IAElD,qBACE,uMAAC;QAAI,WAAU;;0BACb,uMAAC;gBAAG,WAAU;;oBAA6B;oBACtB;oBAAa;;;;;;;0BAGlC,uMAAC;gBAAI,WAAU;;kCACb,uMAAC;wBAAS,OAAM;wBAAmB,MAAM,UAAU,MAAM,IAAI,CAAC;wBAAG,QAAQ;;;;;;kCACzE,uMAAC;wBAAS,OAAM;wBAA2B,MAAM,UAAU,cAAc,IAAI,CAAC;wBAAG,QAAQ;;;;;;;;;;;;;;;;;;AAIjG;KAlBwB;AAoBxB,SAAS,SAAS,KAAuB;QAAvB,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,GAAvB;IAChB,MAAM,YAAY,OAAO,OAAO,CAAC,MAAM,GAAG,CAAC;YAAC,CAAC,MAAM,MAAM;eAAM;YAAE;YAAM;QAAM;;IAC7E,MAAM,QAAQ,UAAU,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,KAAK,EAAE;IAE1D,6BAA6B;IAC7B,MAAM,YAAY,CAAC,IAAM,CAAC,AAAC,IAAI,QAAS,GAAG,EAAE,OAAO,CAAC,KAAK;IAE1D,qBACE,uMAAC;QAAI,WAAU;;0BACb,uMAAC;gBAAE,WAAU;0BAA6B;;;;;;0BAE1C,uMAAC,uMAAmB;gBAAC,OAAM;gBAAO,QAAQ;0BACxC,cAAA,uMAAC,6KAAQ;;sCACP,uMAAC,mKAAG;4BACF,MAAM;4BACN,SAAQ;4BACR,SAAQ;4BACR,aAAa;4BACb,OAAO;oCAAC,EAAE,IAAI,EAAE,KAAK,EAAE;uCAAK,AAAC,GAAW,OAAT,MAAK,MAAqB,OAAjB,UAAU;;sCAEjD,UAAU,GAAG,CAAC,CAAC,OAAO,sBACrB,uMAAC,yKAAI;oCAAa,MAAM,MAAM,CAAC,QAAQ,OAAO,MAAM,CAAC;mCAA1C;;;;;;;;;;sCAIf,uMAAC,+KAAO;4BACN,WAAW,CAAC,QAAU,UAAU;4BAChC,gBAAgB,CAAC,OAAS;;;;;;;;;;;;;;;;;;;;;;;AAMtC;MAjCS","debugId":null}},
    {"offset": {"line": 805, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/components/forecastChart.jsx"],"sourcesContent":["\"use client\";\r\n\r\nimport {\r\n  LineChart,\r\n  Line,\r\n  XAxis,\r\n  YAxis,\r\n  Tooltip,\r\n  CartesianGrid,\r\n  ResponsiveContainer,\r\n  Legend\r\n} from \"recharts\";\r\n\r\nexport default function ForecastChart({ historyData, forecastData, retrainModel }) {\r\n\r\n  // ---------- ACTUAL DATA ----------\r\n  const safeHistory = Array.isArray(historyData)\r\n    ? historyData.map(d => ({\r\n        year: d.year,\r\n        actual: d.totalIncome ?? 0,\r\n      }))\r\n    : [];\r\n\r\n  // ---------- FORECAST DATA (PROPHET) ----------\r\n  const safeForecast = Array.isArray(forecastData)\r\n  ? forecastData.map(f => ({\r\n      year: f.year,\r\n      forecast: f.value ?? 0,\r\n    }))\r\n  : [];\r\n\r\n\r\n  const combinedData = [...safeHistory, ...safeForecast];\r\n\r\n  return (\r\n    <div className=\"bg-white shadow rounded-lg p-4 mt-6\">\r\n      <h3 className=\"text-lg font-semibold mb-2\">\r\n        Actual vs Forecasted Income (Next 5 Years)\r\n      </h3>\r\n\r\n      <ResponsiveContainer width=\"100%\" height={350}>\r\n        <LineChart data={combinedData}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" />\r\n          <XAxis dataKey=\"year\" />\r\n          <YAxis tickFormatter={(v) => `₱${(v / 1_000_000).toFixed(1)}M`} />\r\n          <Tooltip formatter={(v) => `₱${v.toLocaleString()}`} />\r\n          <Legend />\r\n\r\n          <Line\r\n            type=\"monotone\"\r\n            dataKey=\"actual\"\r\n            name=\"Actual Income\"\r\n            stroke=\"#4F46E5\"\r\n            strokeWidth={3}\r\n            dot={{ r: 4 }}\r\n            isAnimationActive={false}\r\n            connectNulls\r\n          />\r\n\r\n          <Line\r\n            type=\"monotone\"\r\n            dataKey=\"forecast\"\r\n            name=\"Forecast Income (Prophet)\"\r\n            stroke=\"#10B981\"\r\n            strokeDasharray=\"6 6\"\r\n            strokeWidth={3}\r\n            dot={{ r: 4 }}\r\n            isAnimationActive={false}\r\n            connectNulls\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n\r\n      <button\r\n        onClick={retrainModel}\r\n        className=\"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700\"\r\n      >\r\n        Retrain Forecast Model\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;;;AAae,SAAS,cAAc,KAA2C;QAA3C,EAAE,WAAW,EAAE,YAAY,EAAE,YAAY,EAAE,GAA3C;IAEpC,oCAAoC;IACpC,MAAM,cAAc,MAAM,OAAO,CAAC,eAC9B,YAAY,GAAG,CAAC,CAAA;YAEN;eAFY;YACpB,MAAM,EAAE,IAAI;YACZ,QAAQ,CAAA,iBAAA,EAAE,WAAW,cAAb,4BAAA,iBAAiB;QAC3B;SACA,EAAE;IAEN,gDAAgD;IAChD,MAAM,eAAe,MAAM,OAAO,CAAC,gBACjC,aAAa,GAAG,CAAC,CAAA;YAEL;eAFW;YACrB,MAAM,EAAE,IAAI;YACZ,UAAU,CAAA,WAAA,EAAE,KAAK,cAAP,sBAAA,WAAW;QACvB;SACA,EAAE;IAGJ,MAAM,eAAe;WAAI;WAAgB;KAAa;IAEtD,qBACE,uMAAC;QAAI,WAAU;;0BACb,uMAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAI3C,uMAAC,uMAAmB;gBAAC,OAAM;gBAAO,QAAQ;0BACxC,cAAA,uMAAC,+KAAS;oBAAC,MAAM;;sCACf,uMAAC,2LAAa;4BAAC,iBAAgB;;;;;;sCAC/B,uMAAC,2KAAK;4BAAC,SAAQ;;;;;;sCACf,uMAAC,2KAAK;4BAAC,eAAe,CAAC,IAAM,AAAC,IAA8B,OAA3B,CAAC,IAAI,SAAS,EAAE,OAAO,CAAC,IAAG;;;;;;sCAC5D,uMAAC,+KAAO;4BAAC,WAAW,CAAC,IAAM,AAAC,IAAsB,OAAnB,EAAE,cAAc;;;;;;sCAC/C,uMAAC,6KAAM;;;;;sCAEP,uMAAC,yKAAI;4BACH,MAAK;4BACL,SAAQ;4BACR,MAAK;4BACL,QAAO;4BACP,aAAa;4BACb,KAAK;gCAAE,GAAG;4BAAE;4BACZ,mBAAmB;4BACnB,YAAY;;;;;;sCAGd,uMAAC,yKAAI;4BACH,MAAK;4BACL,SAAQ;4BACR,MAAK;4BACL,QAAO;4BACP,iBAAgB;4BAChB,aAAa;4BACb,KAAK;gCAAE,GAAG;4BAAE;4BACZ,mBAAmB;4BACnB,YAAY;;;;;;;;;;;;;;;;;0BAKlB,uMAAC;gBACC,SAAS;gBACT,WAAU;0BACX;;;;;;;;;;;;AAKP;KApEwB","debugId":null}},
    {"offset": {"line": 963, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/components/forecastSummary.jsx"],"sourcesContent":["\"use client\";\r\n\r\nexport default function ForecastSummary({ data }) {\r\n  // -------------------------------\r\n  // GUARD: No usable forecast data\r\n  // -------------------------------\r\n  if (!Array.isArray(data) || data.length === 0) {\r\n    return (\r\n      <div className=\"bg-white shadow rounded-lg p-4 mt-4\">\r\n        <p className=\"text-gray-500 text-center\">\r\n          Forecast not available yet. Please retrain the model.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // -------------------------------\r\n  // SORT & FILTER VALID VALUES\r\n  // -------------------------------\r\n  const sorted = [...data]\r\n    .filter(d => typeof d.value === \"number\" && !isNaN(d.value))\r\n    .sort((a, b) => a.year - b.year);\r\n\r\n  if (sorted.length === 0) {\r\n    return (\r\n      <div className=\"bg-white shadow rounded-lg p-4 mt-4\">\r\n        <p className=\"text-gray-500 text-center\">\r\n          Forecast not available yet. Please retrain the model.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // -------------------------------\r\n  // NEXT YEAR FORECAST\r\n  // -------------------------------\r\n  const nextYear = sorted[0];\r\n\r\n  // -------------------------------\r\n  // NEXT 2–5 YEAR AVERAGE\r\n  // -------------------------------\r\n  const firstFive = sorted.slice(0, 5);\r\n\r\n  const avgForecast =\r\n    firstFive.reduce((sum, entry) => sum + entry.value, 0) /\r\n    firstFive.length;\r\n\r\n  // -------------------------------\r\n  // GROWTH RATE\r\n  // -------------------------------\r\n  const growthRate =\r\n    firstFive.length > 1\r\n      ? ((firstFive[firstFive.length - 1].value - firstFive[0].value) /\r\n          firstFive[0].value) *\r\n        100\r\n      : 0;\r\n\r\n  // -------------------------------\r\n  // FORMATTER\r\n  // -------------------------------\r\n  const format = (v) =>\r\n    new Intl.NumberFormat(\"en-PH\", {\r\n      style: \"currency\",\r\n      currency: \"PHP\",\r\n    }).format(v);\r\n\r\n  // -------------------------------\r\n  // RENDER\r\n  // -------------------------------\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 my-4\">\r\n      <Card\r\n        label={`Next Year Forecast (${nextYear.year})`}\r\n        value={format(nextYear.value)}\r\n        color=\"indigo\"\r\n      />\r\n\r\n      <Card\r\n        label=\"Next 2-Year Average Forecast\"\r\n        value={format(avgForecast)}\r\n        color=\"green\"\r\n      />\r\n\r\n      <Card\r\n        label=\"Next Forecast Growth Rate\"\r\n        value={`${growthRate.toFixed(2)}%`}\r\n        color=\"yellow\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// -------------------------------\r\n// CARD COMPONENT\r\n// -------------------------------\r\nfunction Card({ label, value, color }) {\r\n  const colors = {\r\n    indigo: \"bg-indigo-50 text-indigo-700\",\r\n    green: \"bg-green-50 text-green-700\",\r\n    yellow: \"bg-yellow-50 text-yellow-700\",\r\n  };\r\n\r\n  return (\r\n    <div className={`p-4 rounded-lg text-center ${colors[color]}`}>\r\n      <p className=\"text-sm text-gray-600\">{label}</p>\r\n      <p className=\"text-lg font-semibold\">{value}</p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AAEe,SAAS,gBAAgB,KAAQ;QAAR,EAAE,IAAI,EAAE,GAAR;IACtC,kCAAkC;IAClC,iCAAiC;IACjC,kCAAkC;IAClC,IAAI,CAAC,MAAM,OAAO,CAAC,SAAS,KAAK,MAAM,KAAK,GAAG;QAC7C,qBACE,uMAAC;YAAI,WAAU;sBACb,cAAA,uMAAC;gBAAE,WAAU;0BAA4B;;;;;;;;;;;IAK/C;IAEA,kCAAkC;IAClC,6BAA6B;IAC7B,kCAAkC;IAClC,MAAM,SAAS;WAAI;KAAK,CACrB,MAAM,CAAC,CAAA,IAAK,OAAO,EAAE,KAAK,KAAK,YAAY,CAAC,MAAM,EAAE,KAAK,GACzD,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,IAAI,GAAG,EAAE,IAAI;IAEjC,IAAI,OAAO,MAAM,KAAK,GAAG;QACvB,qBACE,uMAAC;YAAI,WAAU;sBACb,cAAA,uMAAC;gBAAE,WAAU;0BAA4B;;;;;;;;;;;IAK/C;IAEA,kCAAkC;IAClC,qBAAqB;IACrB,kCAAkC;IAClC,MAAM,WAAW,MAAM,CAAC,EAAE;IAE1B,kCAAkC;IAClC,wBAAwB;IACxB,kCAAkC;IAClC,MAAM,YAAY,OAAO,KAAK,CAAC,GAAG;IAElC,MAAM,cACJ,UAAU,MAAM,CAAC,CAAC,KAAK,QAAU,MAAM,MAAM,KAAK,EAAE,KACpD,UAAU,MAAM;IAElB,kCAAkC;IAClC,cAAc;IACd,kCAAkC;IAClC,MAAM,aACJ,UAAU,MAAM,GAAG,IACf,AAAC,CAAC,SAAS,CAAC,UAAU,MAAM,GAAG,EAAE,CAAC,KAAK,GAAG,SAAS,CAAC,EAAE,CAAC,KAAK,IAC1D,SAAS,CAAC,EAAE,CAAC,KAAK,GACpB,MACA;IAEN,kCAAkC;IAClC,YAAY;IACZ,kCAAkC;IAClC,MAAM,SAAS,CAAC,IACd,IAAI,KAAK,YAAY,CAAC,SAAS;YAC7B,OAAO;YACP,UAAU;QACZ,GAAG,MAAM,CAAC;IAEZ,kCAAkC;IAClC,SAAS;IACT,kCAAkC;IAClC,qBACE,uMAAC;QAAI,WAAU;;0BACb,uMAAC;gBACC,OAAO,AAAC,uBAAoC,OAAd,SAAS,IAAI,EAAC;gBAC5C,OAAO,OAAO,SAAS,KAAK;gBAC5B,OAAM;;;;;;0BAGR,uMAAC;gBACC,OAAM;gBACN,OAAO,OAAO;gBACd,OAAM;;;;;;0BAGR,uMAAC;gBACC,OAAM;gBACN,OAAO,AAAC,GAAwB,OAAtB,WAAW,OAAO,CAAC,IAAG;gBAChC,OAAM;;;;;;;;;;;;AAId;KAxFwB;AA0FxB,kCAAkC;AAClC,iBAAiB;AACjB,kCAAkC;AAClC,SAAS,KAAK,KAAuB;QAAvB,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAvB;IACZ,MAAM,SAAS;QACb,QAAQ;QACR,OAAO;QACP,QAAQ;IACV;IAEA,qBACE,uMAAC;QAAI,WAAW,AAAC,8BAA2C,OAAd,MAAM,CAAC,MAAM;;0BACzD,uMAAC;gBAAE,WAAU;0BAAyB;;;;;;0BACtC,uMAAC;gBAAE,WAAU;0BAAyB;;;;;;;;;;;;AAG5C;MAbS","debugId":null}},
    {"offset": {"line": 1123, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/transactions/page.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { supabase } from \"../../../lib/supabaseClient\"\r\nimport { AlertCircle, TrendingUp, RefreshCw, Upload, BarChart3 } from \"lucide-react\"\r\n\r\n// Hooks\r\nimport useBudgetData from \"./lib/useBudgetData\"\r\nimport useBreakdownData from \"./lib/useBreakdownData\"\r\n\r\n// Components\r\nimport BudgetUploader from \"./components/budgetUploader\"\r\nimport SummaryCards from \"./components/summaryCards\"\r\n//import IncomeTrendChart from \"./components/incomeTrendChart\"\r\nimport BreakdownPieSection from \"./components/breakdownPieSection\"\r\nimport ForecastChart from \"./components/forecastChart\"\r\nimport ForecastSummary from \"./components/forecastSummary\"\r\n\r\nexport default function TransactionPage() {\r\n  const [session, setSession] = useState(null)\r\n  const [selectedYear, setSelectedYear] = useState(null)\r\n  const [forecastData, setForecastData] = useState([])\r\n  const [isRetraining, setIsRetraining] = useState(false)\r\n  const [error, setError] = useState(null)\r\n\r\n  // Custom hooks\r\n  const { budgetData, loading, fetchBudgetData } = useBudgetData()\r\n  const { breakdownData, fetchBreakdownData } = useBreakdownData()\r\n\r\n  useEffect(() => {\r\n    if (budgetData.length > 0) {\r\n      loadForecast();\r\n    }\r\n  }, [budgetData]);\r\n\r\n  // -------------------------------------------------------\r\n  // LOAD FORECAST FROM PYTHON BACKEND\r\n  // -------------------------------------------------------\r\n  async function loadForecast() {\r\n    try {\r\n      setError(null)\r\n      const response = await fetch(\"/api/forecast\", { cache: \"no-store\" });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch forecast data')\r\n      }\r\n      \r\n      const data = await response.json();\r\n\r\n      // Find last actual year\r\n      const lastActualYear =\r\n        budgetData.length > 0\r\n          ? Math.max(...budgetData.map(d => d.year))\r\n          : 0;\r\n\r\n      // Keep only FUTURE forecast years\r\n      const formatted = Array.isArray(data)\r\n        ? data\r\n            .filter(d => d.year > lastActualYear)\r\n            .map(d => ({\r\n              year: d.year,\r\n              value: Number(d.yhat_upper),\r\n              lower: Number(d.yhat_lower),\r\n              upper: Number(d.yhat_upper),\r\n            }))\r\n        : [];\r\n\r\n      console.log(\"Filtered future forecast:\", formatted);\r\n      setForecastData(formatted);\r\n\r\n    } catch (err) {\r\n      console.error(\"Forecast API error:\", err);\r\n      setError(\"Failed to load forecast data. Please try again.\")\r\n    }\r\n  }\r\n\r\n  // -------------------------------------------------------\r\n  // RETRAIN MODEL\r\n  // -------------------------------------------------------\r\n  async function retrainModel() {\r\n    try {\r\n      setIsRetraining(true)\r\n      setError(null)\r\n      console.log(\"Retraining Prophet model...\");\r\n\r\n      const res = await fetch(\"/api/retrain\", {\r\n        method: \"POST\",\r\n      });\r\n\r\n      if (!res.ok) {\r\n        throw new Error('Failed to retrain model')\r\n      }\r\n\r\n      const data = await res.json();\r\n      console.log(\"Retrain response:\", data);\r\n\r\n      await loadForecast();\r\n    } catch (err) {\r\n      console.error(\"Retrain error:\", err);\r\n      setError(\"Failed to retrain model. Please try again.\")\r\n    } finally {\r\n      setIsRetraining(false)\r\n    }\r\n  }\r\n\r\n  // -------------------------------------------------------\r\n  // AUTH CHECK\r\n  // -------------------------------------------------------\r\n  useEffect(() => {\r\n    supabase.auth.getSession().then(({ data: { session } }) => {\r\n      setSession(session)\r\n      if (session) {\r\n        fetchBudgetData()\r\n        fetchBreakdownData()\r\n      }\r\n    })\r\n\r\n    const { data: listener } = supabase.auth.onAuthStateChange(\r\n      (_event, session) => {\r\n        setSession(session)\r\n        if (session) {\r\n          fetchBudgetData()\r\n          fetchBreakdownData()\r\n        }\r\n      }\r\n    )\r\n\r\n    return () => listener.subscription.unsubscribe()\r\n  }, [])\r\n\r\n  // -------------------------------------------------------\r\n  // WHEN BUDGET DATA IS READY, RETRAIN MODEL ONCE\r\n  // -------------------------------------------------------\r\n  useEffect(() => {\r\n    if (budgetData.length > 0) {\r\n      console.log(\"Budget data ready — retraining model once.\")\r\n      retrainModel()\r\n    }\r\n  }, [budgetData])\r\n\r\n  // -------------------------------------------------------\r\n  // RENDER UI\r\n  // -------------------------------------------------------\r\n  if (!session) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"max-w-md w-full mx-auto\">\r\n          <div className=\"bg-white shadow-lg rounded-lg p-8 text-center\">\r\n            <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4\">\r\n              <AlertCircle className=\"h-6 w-6 text-blue-600\" />\r\n            </div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Authentication Required</h3>\r\n            <p className=\"text-sm text-gray-600\">Please log in to access the budget dashboard</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <RefreshCw className=\"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Loading Dashboard</h3>\r\n          <p className=\"text-sm text-gray-600\">Fetching your budget data...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const selectedData = breakdownData[selectedYear] || {}\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Header Section */}\r\n      <div className=\"bg-white shadow-sm border-b border-gray-200\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"flex items-center justify-center h-10 w-10 rounded-lg bg-blue-600\">\r\n                <BarChart3 className=\"h-6 w-6 text-white\" />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">Barangay Budget Dashboard</h1>\r\n                <p className=\"text-sm text-gray-600\">Monitor and forecast your budget performance</p>\r\n              </div>\r\n            </div>\r\n            {budgetData.length > 0 && (\r\n              <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\r\n                <TrendingUp className=\"h-4 w-4\" />\r\n                <span>{budgetData.length} years of data</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* Error Message */}\r\n        {error && (\r\n          <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n            <div className=\"flex items-center\">\r\n              <AlertCircle className=\"h-5 w-5 text-red-400 mr-3\" />\r\n              <div className=\"text-sm text-red-800\">{error}</div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"space-y-8\">\r\n          {/* Upload Section */}\r\n          <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n            <div className=\"px-6 py-4 border-b border-gray-200\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <Upload className=\"h-5 w-5 text-gray-500\" />\r\n                <h3 className=\"text-lg font-medium text-gray-900\">Data Management</h3>\r\n              </div>\r\n              <p className=\"mt-1 text-sm text-gray-600\">Upload new budget data to update your dashboard</p>\r\n            </div>\r\n            <div className=\"p-6\">\r\n              <BudgetUploader refresh={fetchBudgetData} />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Summary Cards */}\r\n          {budgetData.length > 0 && (\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n              <div className=\"px-6 py-4 border-b border-gray-200\">\r\n                <h3 className=\"text-lg font-medium text-gray-900\">Budget Overview</h3>\r\n                <p className=\"mt-1 text-sm text-gray-600\">Key financial metrics and performance indicators</p>\r\n              </div>\r\n              <div className=\"p-6\">\r\n                <SummaryCards data={budgetData} />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Income Trend Chart */}\r\n          {budgetData.length > 0 && (\r\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n              <div className=\"px-6 py-4 border-b border-gray-200\">\r\n                <h3 className=\"text-lg font-medium text-gray-900\">Historical Trends</h3>\r\n                <p className=\"mt-1 text-sm text-gray-600\">Track your budget performance over time</p>\r\n              </div>\r\n              <div className=\"p-6\">\r\n                <IncomeTrendChart data={budgetData} onYearClick={setSelectedYear} />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Forecast Section */}\r\n          {forecastData.length > 0 && (\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n              {/* Forecast Summary */}\r\n              <div className=\"lg:col-span-1\">\r\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n                  <div className=\"px-6 py-4 border-b border-gray-200\">\r\n                    <h3 className=\"text-lg font-medium text-gray-900\">Forecast Summary</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-600\">Predicted budget performance</p>\r\n                  </div>\r\n                  <div className=\"p-6\">\r\n                    <ForecastSummary data={forecastData} />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Forecast Chart */}\r\n              <div className=\"lg:col-span-2\">\r\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\r\n                  <div className=\"px-6 py-4 border-b border-gray-200 flex items-center justify-between\">\r\n                    <div>\r\n                      <h3 className=\"text-lg font-medium text-gray-900\">Budget Forecast</h3>\r\n                      <p className=\"mt-1 text-sm text-gray-600\">AI-powered budget predictions</p>\r\n                    </div>\r\n                    <button\r\n                      onClick={retrainModel}\r\n                      disabled={isRetraining}\r\n                      className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\r\n                    >\r\n                      <RefreshCw className={`h-4 w-4 mr-2 ${isRetraining ? 'animate-spin' : ''}`} />\r\n                      {isRetraining ? 'Retraining...' : 'Retrain Model'}\r\n                    </button>\r\n                  </div>\r\n                  <div className=\"p-6\">\r\n                    <ForecastChart\r\n                      historyData={budgetData}\r\n                      forecastData={forecastData}\r\n                      retrainModel={retrainModel}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Empty State */}\r\n          {budgetData.length === 0 && !loading && (\r\n            <div className=\"text-center py-12\">\r\n              <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 mb-4\">\r\n                <BarChart3 className=\"h-6 w-6 text-gray-400\" />\r\n              </div>\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Budget Data Found</h3>\r\n              <p className=\"text-sm text-gray-600 mb-6\">Get started by uploading your first budget file</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}