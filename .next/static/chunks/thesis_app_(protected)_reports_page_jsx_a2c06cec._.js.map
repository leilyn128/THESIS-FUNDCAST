{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/reports/page.jsx"],"sourcesContent":["\"use client\"\r\nimport { useEffect, useState } from \"react\"\r\nimport { supabase } from \"../../../lib/supabaseClient\"\r\n\r\nimport PieChartComponent from \"./components/PieChart.jsx\"\r\n\r\nexport default function ReportsPage() {\r\n  const [files, setFiles] = useState([])\r\n  const [selectedFile, setSelectedFile] = useState(\"\")\r\n  const [trialBalance, setTrialBalance] = useState([])\r\n  const [breakdown, setBreakdown] = useState([])\r\n  const [loading, setLoading] = useState(false)\r\n  const [message, setMessage] = useState(\"\")\r\n  const [selectedYear, setSelectedYear] = useState(\"all\")\r\n  const [selectedCategory, setSelectedCategory] = useState(\"all\")\r\n\r\n  // Fetch imported files\r\n  useEffect(() => {\r\n    const fetchFiles = async () => {\r\n      const { data, error } = await supabase.storage.from(\"imports\").list(\"\", { limit: 100 })\r\n      if (error) {\r\n        console.error(\"Error fetching imports:\", error)\r\n        setMessage(\"‚ùå Failed to load imported files.\")\r\n        return\r\n      }\r\n\r\n      const excelFiles = data.filter(f => f.name.endsWith(\".xlsx\") || f.name.endsWith(\".csv\"))\r\n      const filesWithOriginalName = excelFiles.map(f => {\r\n        const parts = f.name.split(\"_\")\r\n        const originalName = parts.slice(2).join(\"_\")\r\n        return { storageName: f.name, displayName: originalName }\r\n      })\r\n\r\n      setFiles(filesWithOriginalName)\r\n    }\r\n\r\n    fetchFiles()\r\n    fetchBreakdown()\r\n  }, [])\r\n\r\n  // Fetch barangay_budget_breakdown from Supabase\r\n  const fetchBreakdown = async () => {\r\n    setLoading(true);\r\n    const { data, error } = await supabase\r\n      .from(\"barangay_budget_breakdown\")\r\n      .select(\"*\")\r\n      .order(\"year\", { ascending: true });\r\n\r\n    if (error) {\r\n      console.error(\"Error fetching breakdown:\", error);\r\n      setMessage(\"‚ùå Failed to load budget breakdown.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (data && data.length > 0) {\r\n      let runningBalance = 0;\r\n      const recalculated = data.map((t) => {\r\n        runningBalance = runningBalance + (t.deposit || 0) - (t.withdrawal || 0);\r\n        return { ...t, balance: runningBalance };\r\n      });\r\n      setBreakdown(recalculated);\r\n    } else {\r\n      setBreakdown([]);\r\n    }\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  // Get filtered data\r\n  const filteredData = breakdown.filter((row) => {\r\n    const matchYear = selectedYear === \"all\" || row.year === Number(selectedYear)\r\n    const matchCategory = selectedCategory === \"all\" || row.category === selectedCategory\r\n    return matchYear && matchCategory\r\n  })\r\n\r\n  // Extract unique years and categories\r\n  const years = Array.from(new Set(breakdown.map((b) => b.year))).sort((a, b) => b - a)\r\n  const categories = Array.from(new Set(breakdown.map((b) => b.category)))\r\n\r\n  const totalAmount = filteredData.reduce((sum, r) => sum + Number(r.amount || 0), 0)\r\n\r\n  // Prepare data for Pie chart\r\n  const pieChartData = categories.map((category) => {\r\n    const categoryAmount = filteredData\r\n      .filter((row) => row.category === category)\r\n      .reduce((sum, row) => sum + Number(row.amount || 0), 0);\r\n    return { category, amount: categoryAmount };\r\n  });\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-8\">\r\n      <h1 className=\"text-2xl font-bold text-green-700\">üìä Reports</h1>\r\n\r\n      {/* Imported Files Section */}\r\n      <div className=\"bg-white p-6 rounded-lg shadow space-y-4\">\r\n        <h2 className=\"text-lg font-semibold text-gray-800\">üìÇ Imported Files</h2>\r\n        <div className=\"overflow-x-auto border rounded-lg\">\r\n          <ul>\r\n            {files.map((file) => (\r\n              <li key={file.storageName} className=\"py-2\">\r\n                <a href=\"#\" className=\"text-blue-600\">{file.displayName}</a>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Barangay Budget Breakdown Section */}\r\n      <div className=\"bg-white p-6 rounded-lg shadow space-y-4\">\r\n        <h2 className=\"text-lg font-semibold text-gray-800\">üèõ Barangay Budget Breakdown</h2>\r\n\r\n        <div className=\"flex flex-wrap gap-4 items-center\">\r\n          <div>\r\n            <label className=\"text-sm text-gray-600 mr-2\">Year:</label>\r\n            <select\r\n              value={selectedYear}\r\n              onChange={(e) => setSelectedYear(e.target.value)}\r\n              className=\"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500\"\r\n            >\r\n              <option value=\"all\">All</option>\r\n              {years.map((y) => (\r\n                <option key={y} value={y}>\r\n                  {y}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"text-sm text-gray-600 mr-2\">Category:</label>\r\n            <select\r\n              value={selectedCategory}\r\n              onChange={(e) => setSelectedCategory(e.target.value)}\r\n              className=\"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500\"\r\n            >\r\n              <option value=\"all\">All</option>\r\n              {categories.map((c) => (\r\n                <option key={c} value={c}>\r\n                  {c}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <p>Loading...</p>\r\n        ) : filteredData.length === 0 ? (\r\n          <p className=\"text-gray-500 italic\">No data available for selected filters.</p>\r\n        ) : (\r\n          <div className=\"overflow-x-auto border rounded-lg mt-4\">\r\n            <table className=\"min-w-full border-collapse text-sm\">\r\n              <thead className=\"bg-gray-100\">\r\n                <tr>\r\n                  <th className=\"border px-4 py-2 text-left\">Year</th>\r\n                  <th className=\"border px-4 py-2 text-left\">Category</th>\r\n                  <th className=\"border px-4 py-2 text-left\">Subcategory</th>\r\n                  <th className=\"border px-4 py-2 text-left\">Description</th>\r\n                  <th className=\"border px-4 py-2 text-right\">Amount (‚Ç±)</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredData.map((row) => (\r\n                  <tr key={row.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"border px-4 py-2\">{row.year}</td>\r\n                    <td className=\"border px-4 py-2\">{row.category}</td>\r\n                    <td className=\"border px-4 py-2\">{row.subcategory}</td>\r\n                    <td className=\"border px-4 py-2\">{row.description}</td>\r\n                    <td className=\"border px-4 py-2 text-right\">\r\n                      ‚Ç±\r\n                      {Number(row.amount).toLocaleString(\"en-PH\", {\r\n                        minimumFractionDigits: 2,\r\n                        maximumFractionDigits: 2,\r\n                      })}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n                <tr className=\"bg-green-50 font-semibold\">\r\n                  <td colSpan=\"4\" className=\"border px-4 py-2 text-right\">\r\n                    TOTAL:\r\n                  </td>\r\n                  <td className=\"border px-4 py-2 text-right\">\r\n                    ‚Ç±\r\n                    {totalAmount.toLocaleString(\"en-PH\", {\r\n                      minimumFractionDigits: 2,\r\n                      maximumFractionDigits: 2,\r\n                    })}\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Pie Chart */}\r\n      <PieChartComponent data={pieChartData} />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}